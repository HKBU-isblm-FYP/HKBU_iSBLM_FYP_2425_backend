import{_ as Se,u as ke,x as Pe,k as Ie,e as Ae,r as l,m as Te,n as K,f as $e,g as _,o as h,c as D,a as e,w as T,v as V,t as y,l as Le,b as f,h as c,i as u,q as Q,d as $,F as W,y as Y,z as Fe,A as Re,B as Ee,p as Me,j as Ne}from"./index-B-03LEUy.js";import{d as Z}from"./project-Kgm5E1UM.js";const n=x=>(Me("data-v-2cf5688a"),x=x(),Ne(),x),Ve={class:"container-fluid px-5"},Oe=n(()=>e("h1",null,"Create Project",-1)),ze={class:"row ms-3"},Be={class:"col-5 me-5 form-group"},Ue={class:"row"},qe={class:"border border-2 rounded-2 p-2 my-1"},Ge=n(()=>e("label",{for:"projectTitle",class:"form-label"},"Project Title:",-1)),Je={class:"row h-50"},Xe={class:"border border-2 rounded-2 p-2 my-1"},He=n(()=>e("label",{for:"projectStructure",class:"form-label"},"Project Structure:",-1)),Ke={class:"col-6 form-group"},Qe={class:"border border-2 rounded-2 p-2 my-1"},We=n(()=>e("label",{for:"projectImage",class:"form-label"},"Project Image:",-1)),Ye={class:"dropzone"},Ze=n(()=>e("h4",{for:"file-input"},"Click or Drag to Add Image",-1)),et=["src"],tt={key:0},ot={class:"text-center"},at={class:"row my-1 ms-3"},lt={class:"col-5 form-group border border-2 rounded-2 p-2 me-2"},st=n(()=>e("label",{for:"projectStructure",class:"form-label"},"Project Lessons - sort:",-1)),nt=n(()=>e("hr",null,null,-1)),rt=n(()=>e("p",null,[e("code",null," Drag to select the order of the lessons ")],-1)),ct=["onClick"],it={class:"col-6 form-group border border-2 rounded-2 p-2 mx-5"},dt={class:"d-flex justify-content-between"},ut=n(()=>e("label",{for:"projectStructure",class:"form-label"},"Project Lessons - search & add:",-1)),pt=n(()=>e("hr",null,null,-1)),vt=["onClick"],mt=["onClick"],_t={class:"row my-1 ms-3"},ft={class:"col-5 form-group border border-2 rounded-2 p-2 me-2"},gt=n(()=>e("label",{for:"teamMembership",class:"form-label"},"Members: ",-1)),ht=n(()=>e("b",null,"Users:",-1)),bt={class:"col-6 form-group border border-2 rounded-2 p-2 mx-5"},wt={class:"row"},Ct={class:"col-6"},jt=n(()=>e("label",{for:"documents",class:"form-label"},"Documents: Upload To Express ",-1)),Dt={class:"ex-center"},yt=n(()=>e("p",null,"Click to upload",-1)),xt={class:"col-6"},St={class:"tags"},kt=n(()=>e("br",null,null,-1)),Pt=n(()=>e("button",{type:"submit",class:"btn btn-primary"},"Create Project",-1)),It={__name:"ProjectCreateView",setup(x){const S=ke().token,ee=Pe();Ie();const te=Ae(),k=l(Z);l("");const L=l("");l([]);const F=l("");l("");const b=l([]),P=l(0),p=l(!1),O=l("vote_count"),z=l("desc"),oe=l("desc");let B=l(1),U=l(6);l(0);const g=l(""),v=l([]);l([]);const w=async()=>{const o=[`search=${g.value}`,`perPage=${U.value}`,`page=${B.value}`].join("&");p.value=!0,await fetch(`/api/lessons/all?${o}`,{headers:{"X-MECE":v.value.toString(),Authorization:`Bearer ${S}`}}).then(async t=>await t.json()).then(t=>{console.log(t),b.value=t.lessons,P.value=t.size,p.value=!1}).catch(t=>{throw b.value=[],P.value=0,p.value=!1,t})},ae=(o,t)=>{O.value=o,z.value=t,w()},le=Te(()=>{if(g.value){let o=b.value.filter(t=>t.title.toLowerCase().includes(g.value.toLowerCase()));return G()&&(o=q(o)),o}else return G()?q(b.value):b.value}),q=o=>o.filter(a=>!v.value.includes(a._id)),G=()=>v.value.length>0;K(()=>g.value,()=>{w()}),K(()=>v.value.length,()=>{w()});const se=o=>{B.value=o,w()},ne=o=>{let t={title:o.title,id:o._id};d.value.push(t),v.value.push(t.id)},re=async()=>{const o={title:L.value,structure:F.value,member:C.value.length?C.value:[],progress:d.value.length?d.value:[]};console.log("Create Project",o);let a=await(await fetch("/api/projects/create",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${S}`},body:JSON.stringify(o)})).json();console.log("Inserted: ",a);const r=new FormData;r.append("projectId",a),r.append("projectImage",j.value),i.value.length&&(console.log(i.value),i.value.forEach((A,X)=>{r.append("projectFile",A)}));let N=await fetch("/api/projects/createAttachments",{method:"POST",headers:{Authorization:`Bearer ${S}`},body:r});console.log(await N.json())},R=l(null),E=l(null);l(null),l(null);const ce=l([{field:"id",label:"ID",width:"40",numeric:!0,visible:!1},{field:"title",label:"Title"}]),d=l([]);function ie(o,t,a){R.value=o,E.value=t,a.dataTransfer.effectAllowed="copy"}function de(o,t,a){a.dataTransfer.dropEffect="copy",a.target.closest("tr").classList.add("is-selected"),a.preventDefault()}function ue(o,t,a){a.target.closest("tr").classList.remove("is-selected"),a.preventDefault(),console.log(d)}function pe(o,t,a){a.target.closest("tr").classList.remove("is-selected");const r=t;d.value.splice(E.value,1),d.value.splice(r,0,R.value),ee.notification.open(`Moved ${R.value.title} from row ${E.value+1} to ${r+1}`)}const ve=o=>{const t=d.value.findIndex(r=>r.id===o.id),a=d.value[t];console.log("Removing: ",t,a),d.value.splice(t,1),v.value=v.value.filter(r=>r!==a.id)},me=async()=>{const o=["perPage=99999"].join("&");p.value=!0,fetch(`/api/users/all?${o}`,{headers:{Authorization:`Bearer ${S}`}}).then(t=>t.json()).then(t=>{console.log(t),I=t.users.map((a,r)=>({id:a._id,name:a.name,date:a.createdAt,email:a.email})),console.log("Got Member",I),p.value=!1}).catch(t=>{throw I=[],P.value=0,p.value=!1,t})};let I=[];const J=l([]),C=l([]),_e=l(!1),fe=l(!1);function ge(o){J.value=I.filter(t=>t.name.toString().toLowerCase().indexOf(o.toLowerCase())>=0)}const i=l([]),he=o=>{i.value.splice(o,1)},be=()=>{i.value=[]},we=o=>{let t=o.target.files;console.log("OLD",i.value),console.log("Append",t),i.value=[...i.value,...t],console.log("Result",i.value)},j=l({}),M=l(""),Ce=o=>{j.value=o.files[0],M.value=j.value.name;let t=new FileReader;t.readAsDataURL(j.value),t.onload=a=>{k.value=a.target.result}},je=()=>{k.value=Z,j.value={},M.value=""},De=()=>{console.log("Create Lesson")};return $e(async()=>{await w(),await me()}),(o,t)=>{const a=_("o-table-column"),r=_("o-table"),N=_("o-taginput"),A=_("o-field"),X=_("o-icon"),ye=_("o-upload"),xe=_("o-button");return h(),D("div",Ve,[Oe,e("form",{class:"form-group",onSubmit:t[5]||(t[5]=f(s=>re(),["prevent"]))},[e("div",ze,[e("div",Be,[e("div",Ue,[e("div",qe,[Ge,T(e("input",{type:"text",class:"form-control",id:"projectTitle","onUpdate:modelValue":t[0]||(t[0]=s=>L.value=s),required:""},null,512),[[V,L.value]])])]),e("div",Je,[e("div",Xe,[He,T(e("textarea",{class:"form-control",id:"projectStructure","onUpdate:modelValue":t[1]||(t[1]=s=>F.value=s),required:""},null,512),[[V,F.value]])])])]),e("div",Ke,[e("div",Qe,[We,e("div",Ye,[e("input",{id:"file-input",type:"file",accept:"image/png, image/jpeg",onChange:t[2]||(t[2]=s=>Ce(s.target))},null,32),Ze,e("img",{src:k.value},null,8,et),k.value?(h(),D("h5",tt,"File name: "+y(M.value),1)):Le("",!0)]),e("div",ot,[e("button",{class:"btn btn-danger m-1",onClick:f(je,["prevent"])},"Remove")])])])]),e("div",at,[e("div",lt,[st,nt,e("section",null,[rt,c(r,{data:d.value,draggable:"",onDragstart:ie,onDrop:pe,onDragover:de,onDragleave:ue},{default:u(()=>[(h(!0),D(W,null,Y(ce.value,(s,m)=>(h(),Re(a,Ee({key:m},s),{default:u(({row:H})=>[$(y(H[s.field]),1)]),_:2},1040))),128)),c(a,{field:"action",label:"Remove"},{default:u(s=>[e("button",{class:"btn btn-sm btn-danger",onClick:f(m=>ve(s.row),["prevent"])},"Remove",8,ct)]),_:1})]),_:1},8,["data"])])]),e("div",it,[e("div",dt,[ut,e("button",{class:"btn btn-info",onClick:f(De,["prevent"])}," Create Lesson ")]),e("div",null,[T(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>g.value=s),class:"form-control form-control-sm",placeholder:"Search by Lesson Name"},null,512),[[V,g.value]])]),pt,c(r,{data:le.value,loading:p.value,paginated:"","backend-pagination":"",total:P.value,"per-page":Q(U),"backend-sorting":"","default-sort-direction":oe.value,"default-sort":[O.value,z.value],"aria-next-label":"Next page","aria-previous-label":"Previous page","aria-page-label":"Page","aria-current-label":"Current page",onPageChange:se,onSort:ae,hoverable:!0},{default:u(()=>[c(a,{field:"title",label:"Title",sortable:""},{default:u(s=>[$(y(s.row.title),1)]),_:1}),c(a,{field:"action",label:"Detail"},{default:u(s=>[e("button",{class:"btn btn-primary",onClick:f(m=>Q(te).push({name:"lessonDetail",params:{id:s.row._id}}),["prevent"])}," Detail",8,vt)]),_:1}),c(a,{field:"action",label:"Add"},{default:u(s=>[e("button",{class:"btn btn-primary",onClick:f(m=>ne(s.row),["prevent"])},"Add",8,mt)]),_:1})]),_:1},8,["data","loading","total","per-page","default-sort-direction","default-sort"])])]),e("div",_t,[e("div",ft,[gt,e("section",null,[c(A,{label:"Select name of students"},{default:u(()=>[c(N,{modelValue:C.value,"onUpdate:modelValue":t[4]||(t[4]=s=>C.value=s),data:J.value,"allow-autocomplete":"","allow-new":_e.value,"open-on-focus":fe.value,field:"name",icon:"tag",placeholder:"Add an item",onInput:ge},null,8,["modelValue","data","allow-new","open-on-focus"])]),_:1}),e("p",null,[ht,$(" "+y(C.value),1)])])]),e("div",bt,[e("div",wt,[e("div",Ct,[jt,c(A,null,{default:u(()=>[c(ye,{multiple:"","drag-drop":"",onInput:we},{default:u(()=>[e("section",Dt,[e("p",null,[c(X,{icon:"upload",size:"is-large"})]),yt])]),_:1})]),_:1})]),e("div",xt,[e("div",St,[(h(!0),D(W,null,Y(i.value,(s,m)=>(h(),D("li",{key:m},[$(y(s.name)+" ",1),c(xe,{"icon-left":"close",size:"small","native-type":"button",onClick:H=>he(m)},null,8,["onClick"])]))),128))])]),T(e("button",{class:"btn",onClick:f(be,["prevent"])},"Remove All",512),[[Fe,i.value.length>0]])])])]),kt,Pt],32)])}}},Lt=Se(It,[["__scopeId","data-v-2cf5688a"]]);export{Lt as default};
