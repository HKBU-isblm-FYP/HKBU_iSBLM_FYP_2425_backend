import{G as Mt,_ as xt,o as P,c as X,a as m,t as $,q as v,d as J,p as Lt,j as Tt,u as Rt,k as It,e as Et,r as L,n as Nt,D as Ht,f as Bt,H as Dt,g as Pt,w as re,z as ve,E as ie,v as $t,h as Ne,l as le,F as zt,y as jt,A as He,i as Ot,I as Be,J as Wt}from"./index-B-03LEUy.js";import{A as Ft,E as Vt,N as Je,P as Te,a as ge,S as E,b as Qe,T as j,c as Kt,D as Re,d as me,e as qt,_ as Ut,f as Gt,g as Xt,h as Yt,M as Jt,m as se,i as Qt,j as Zt,k as eo,F as N,l as K,n as to,o as be,p as oo,q as no,r as so,u as ro,s as io,B as lo,t as ao}from"./index-DSMuaTct.js";import{g as Ie,c as ae}from"./index-C_YRfJz0.js";import{d as co,e as uo,u as ho}from"./CRUD-xJdNO43X.js";const fo=Object.freeze(Object.defineProperty({__proto__:null,AllSelection:Ft,EditorState:Vt,NodeSelection:Je,Plugin:Te,PluginKey:ge,Selection:E,SelectionRange:Qe,TextSelection:j,Transaction:Kt},Symbol.toStringTag,{value:"Module"})),po=Object.freeze(Object.defineProperty({__proto__:null,Decoration:Re,DecorationSet:me,EditorView:qt,__endComposition:Ut,__parseFromClipboard:Gt,__serializeForClipboard:Xt},Symbol.toStringTag,{value:"Module"}));var Ze={},et={},we={};const mo=Ie(Yt);var Ae={};const go=Ie(fo);var te={};const bo=Ie(po);var ye={};Object.defineProperty(ye,"__esModule",{value:!0});ye.AnnotationDecoration=void 0;class wo{constructor(e){this.decoration=e}get displayName(){return this.decoration.type.spec.data.displayName}get tag(){return this.decoration.type.spec.data.tag}get id(){return this.decoration.type.spec.id}get from(){return this.decoration.from}get to(){return this.decoration.to}get selectedText(){return this.decoration.type.spec.data.selectedText}get data(){return this.decoration.type.spec.data}get HTMLAttributes(){return this.decoration.type.attrs}toString(){return JSON.stringify({id:this.id,data:this.data,from:this.from,to:this.to,HTMLAttributes:this.HTMLAttributes})}}ye.AnnotationDecoration=wo;var q={};Object.defineProperty(q,"__esModule",{value:!0});q.sortAnnotationsByStart=q.createAnnotationRendering=q.isConflicting=void 0;const yo=(t,e,o,n)=>!(t<n&&e<o||o<e&&n<t);q.isConflicting=yo;const Co=t=>{const e=[],o=[],n=[],s=[];return t.forEach((r,i)=>{let a={action:"open",annotationIndex:i,textAnchor:r.from},l={action:"close",annotationIndex:i,textAnchor:r.to};n[a.textAnchor]||(n[a.textAnchor]=[]),n[a.textAnchor].push(a),n[l.textAnchor]||(n[l.textAnchor]=[]),n[l.textAnchor].push(l)}),n.forEach((r,i)=>{r.forEach(a=>{if(o.length!=0){let l=o[o.length-1];if(l.action==="open"&&l.annotationIndex===a.annotationIndex&&a.action==="close"){o.pop();let c=s[a.annotationIndex]?"fragment-right":"normal",d=s[a.annotationIndex]?e[e.length-1].to:t[a.annotationIndex].from,u=Object.assign(Object.assign({},t[a.annotationIndex]),{from:d,rendering:c});e.push(u)}else if(l.action==="open"&&a.action==="close"){let c=o.findIndex(d=>d.textAnchor===t[a.annotationIndex].from&&d.annotationIndex===a.annotationIndex&&d.action==="open");if(c>-1)o.splice(c,1);else throw Error("Couldn't find opening keyframe for annotation "+a.annotationIndex)}else if(l.action==="open"&&a.action==="open"){let c;s[l.annotationIndex]?c=Object.assign(Object.assign({},t[l.annotationIndex]),{rendering:"fragment-middle",from:e[e.length-1].to,to:t[a.annotationIndex].from}):(c=Object.assign(Object.assign({},t[l.annotationIndex]),{rendering:"fragment-left",to:t[a.annotationIndex].from}),s[l.annotationIndex]=!0),e.push(c),o.push(a)}}else a.action==="open"&&o.push(a)})}),e};q.createAnnotationRendering=Co;const vo=t=>t.sort((e,o)=>e.from-o.from);q.sortAnnotationsByStart=vo;var De;function Ao(){if(De)return te;De=1,Object.defineProperty(te,"__esModule",{value:!0}),te.AnnotationState=void 0;const t=bo,e=ye,o=tt(),n=q;class s{constructor(i){this.decorations=t.DecorationSet.empty,this.options=i}randomId(){return Math.floor(Math.random()*4294967295).toString()}addAnnotation(i){const{map:a}=this.options,{from:l,to:c,data:d}=i,u=this.randomId();a.set(u,{id:u,from:l,to:c,data:d})}updateAnnotation(i){const{map:a}=this.options,l=a.get(i.id);l&&(l.data=i.data)}deleteAnnotation(i){const{map:a}=this.options;a.delete(i)}termsAt(i,a){return this.decorations.find(i,a||i).map(l=>new e.AnnotationDecoration(l))}allAnnotations(){const{map:i}=this.options;return Array.from(i.entries(),([a,l])=>l)}createDecorations(i){const{map:a,styles:l}=this.options,c=[],d=Array.from(a,([h,f])=>Object.assign(Object.assign({},f),{id:h})).filter(h=>"from"in h&&"to"in h);(0,n.createAnnotationRendering)(d).forEach(h=>{const f=h.from,p=h.to;console.log(`[${this.options.instance}] Decoration.inline()`,f,p,{id:h.id,data:h}),f===p&&console.warn(`[${this.options.instance}] corrupt decoration `,h.from,f,h.to,p);let g;switch(h.rendering){case"fragment-left":g=l.leftFragment;break;case"fragment-middle":g=l.middleFragment;break;case"fragment-right":g=l.rightFragment;break;case"normal":g=l.normal;break}let w;h.backgroundColor&&(w={style:"background-color: "+h.backgroundColor+";",class:g}),c.push(t.Decoration.inline(f,p,w||{class:g,style:"background-color: white;"},{id:h.id,data:h,inclusiveEnd:!0}))}),this.decorations=t.DecorationSet.create(i.doc,c)}apply(i,a){const l=i.getMeta(o.AnnotationPluginKey);return l&&l.type?(console.log(`[${this.options.instance}] action: ${l.type}`),l.type==="addAnnotation"&&this.addAnnotation(l),l.type==="updateAnnotation"&&this.updateAnnotation(l),l.type==="deleteAnnotation"&&this.deleteAnnotation(l.id),this.createDecorations(a),this.options.onAnnotationListChange(this.allAnnotations()),this):(this.options.map.forEach((c,d)=>{"from"in c&&"to"in c&&(c.from=i.mapping.map(c.from),c.to=i.mapping.map(c.to))}),this.createDecorations(a),this)}}return te.AnnotationState=s,te}var Pe;function tt(){return Pe||(Pe=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.AnnotationPlugin=t.AnnotationPluginKey=void 0;const e=go,o=Ao();t.AnnotationPluginKey=new e.PluginKey("annotation-magic");const n=s=>new e.Plugin({key:t.AnnotationPluginKey,state:{init(){return new o.AnnotationState({styles:s.styles,map:new Map,instance:s.instance,onAnnotationListChange:s.onAnnotationListChange,onSelectionChange:s.onSelectionChange})},apply(r,i,a,l){return i.apply(r,l)}},props:{decorations(r){const{decorations:i}=this.getState(r),{selection:a}=r;if(a.empty){const l=this.getState(r).termsAt(a.from);return s.onSelectionChange(l),i}else{const l=this.getState(r).termsAt(a.from,a.to);return s.onSelectionChange(l),i}}}});t.AnnotationPlugin=n}(Ae)),Ae}Object.defineProperty(we,"__esModule",{value:!0});we.AnnotationMagic=void 0;const _o=mo,oe=tt();function So(){return _o.Extension.create({name:"annotation-magic",priority:1e3,addOptions(){return{styles:{rightFragment:"",leftFragment:"",normal:"",middleFragment:""},onSelectionChange:t=>t,onAnnotationListChange:t=>t,document:null,field:"annotations",instance:""}},onCreate(){console.log(`[${this.options.instance}] plugin creation  â†’ initial createDecorations`);const t=this.editor.state.tr.setMeta(oe.AnnotationPluginKey,{type:"createDecorations"});this.editor.view.dispatch(t)},addCommands(){return{addAnnotation:t=>({dispatch:e,state:o})=>{const{selection:n}=o;return n.empty?!1:(e&&t&&o.tr.setMeta(oe.AnnotationPluginKey,{type:"addAnnotation",from:n.from,to:n.to,data:t}),!0)},updateAnnotation:(t,e)=>({dispatch:o,state:n})=>(o&&n.tr.setMeta(oe.AnnotationPluginKey,{type:"updateAnnotation",id:t,data:e}),!0),deleteAnnotation:t=>({dispatch:e,state:o})=>(e&&o.tr.setMeta(oe.AnnotationPluginKey,{type:"deleteAnnotation",id:t}),!0)}},addProseMirrorPlugins(){return[(0,oe.AnnotationPlugin)({styles:this.options.styles,onSelectionChange:this.options.onSelectionChange,onAnnotationListChange:this.options.onAnnotationListChange,instance:this.options.instance})]}})}we.AnnotationMagic=So;(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.AnnotationMagic=void 0;var e=we;Object.defineProperty(t,"AnnotationMagic",{enumerable:!0,get:function(){return e.AnnotationMagic}})})(et);var ot={};Object.defineProperty(ot,"__esModule",{value:!0});(function(t){var e=ae&&ae.__createBinding||(Object.create?function(n,s,r,i){i===void 0&&(i=r);var a=Object.getOwnPropertyDescriptor(s,r);(!a||("get"in a?!s.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return s[r]}}),Object.defineProperty(n,i,a)}:function(n,s,r,i){i===void 0&&(i=r),n[i]=s[r]}),o=ae&&ae.__exportStar||function(n,s){for(var r in n)r!=="default"&&!Object.prototype.hasOwnProperty.call(s,r)&&e(s,n,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(et,t),o(ot,t)})(Ze);const ko=/(?:^|\s)(==(?!\s+==)((?:[^=]+))==(?!\s+==))$/,Mo=/(?:^|\s)(==(?!\s+==)((?:[^=]+))==(?!\s+==))/g,xo=Jt.create({name:"highlight",addOptions(){return{multicolor:!1,HTMLAttributes:{}}},addAttributes(){return this.options.multicolor?{color:{default:null,parseHTML:t=>t.getAttribute("data-color")||t.style.backgroundColor,renderHTML:t=>t.color?{"data-color":t.color,style:`background-color: ${t.color}; color: inherit`}:{}}}:{}},parseHTML(){return[{tag:"mark"}]},renderHTML({HTMLAttributes:t}){return["mark",se(this.options.HTMLAttributes,t),0]},addCommands(){return{setHighlight:t=>({commands:e})=>e.setMark(this.name,t),toggleHighlight:t=>({commands:e})=>e.toggleMark(this.name,t),unsetHighlight:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-h":()=>this.editor.commands.toggleHighlight()}},addInputRules(){return[Qt({find:ko,type:this.type})]},addPasteRules(){return[Zt({find:Mo,type:this.type})]}});var Se,ke;if(typeof WeakMap<"u"){let t=new WeakMap;Se=e=>t.get(e),ke=(e,o)=>(t.set(e,o),o)}else{const t=[];let o=0;Se=n=>{for(let s=0;s<t.length;s+=2)if(t[s]==n)return t[s+1]},ke=(n,s)=>(o==10&&(o=0),t[o++]=n,t[o++]=s)}var k=class{constructor(t,e,o,n){this.width=t,this.height=e,this.map=o,this.problems=n}findCell(t){for(let e=0;e<this.map.length;e++){const o=this.map[e];if(o!=t)continue;const n=e%this.width,s=e/this.width|0;let r=n+1,i=s+1;for(let a=1;r<this.width&&this.map[e+a]==o;a++)r++;for(let a=1;i<this.height&&this.map[e+this.width*a]==o;a++)i++;return{left:n,top:s,right:r,bottom:i}}throw new RangeError(`No cell with offset ${t} found`)}colCount(t){for(let e=0;e<this.map.length;e++)if(this.map[e]==t)return e%this.width;throw new RangeError(`No cell with offset ${t} found`)}nextCell(t,e,o){const{left:n,right:s,top:r,bottom:i}=this.findCell(t);return e=="horiz"?(o<0?n==0:s==this.width)?null:this.map[r*this.width+(o<0?n-1:s)]:(o<0?r==0:i==this.height)?null:this.map[n+this.width*(o<0?r-1:i)]}rectBetween(t,e){const{left:o,right:n,top:s,bottom:r}=this.findCell(t),{left:i,right:a,top:l,bottom:c}=this.findCell(e);return{left:Math.min(o,i),top:Math.min(s,l),right:Math.max(n,a),bottom:Math.max(r,c)}}cellsInRect(t){const e=[],o={};for(let n=t.top;n<t.bottom;n++)for(let s=t.left;s<t.right;s++){const r=n*this.width+s,i=this.map[r];o[i]||(o[i]=!0,!(s==t.left&&s&&this.map[r-1]==i||n==t.top&&n&&this.map[r-this.width]==i)&&e.push(i))}return e}positionAt(t,e,o){for(let n=0,s=0;;n++){const r=s+o.child(n).nodeSize;if(n==t){let i=e+t*this.width;const a=(t+1)*this.width;for(;i<a&&this.map[i]<s;)i++;return i==a?r-1:this.map[i]}s=r}}static get(t){return Se(t)||ke(t,Lo(t))}};function Lo(t){if(t.type.spec.tableRole!="table")throw new RangeError("Not a table node: "+t.type.name);const e=To(t),o=t.childCount,n=[];let s=0,r=null;const i=[];for(let c=0,d=e*o;c<d;c++)n[c]=0;for(let c=0,d=0;c<o;c++){const u=t.child(c);d++;for(let p=0;;p++){for(;s<n.length&&n[s]!=0;)s++;if(p==u.childCount)break;const g=u.child(p),{colspan:w,rowspan:A,colwidth:O}=g.attrs;for(let T=0;T<A;T++){if(T+c>=o){(r||(r=[])).push({type:"overlong_rowspan",pos:d,n:A-T});break}const W=s+T*e;for(let B=0;B<w;B++){n[W+B]==0?n[W+B]=d:(r||(r=[])).push({type:"collision",row:c,pos:d,n:w-B});const U=O&&O[B];if(U){const F=(W+B)%e*2,G=i[F];G==null||G!=U&&i[F+1]==1?(i[F]=U,i[F+1]=1):G==U&&i[F+1]++}}}s+=w,d+=g.nodeSize}const h=(c+1)*e;let f=0;for(;s<h;)n[s++]==0&&f++;f&&(r||(r=[])).push({type:"missing",row:c,n:f}),d++}const a=new k(e,o,n,r);let l=!1;for(let c=0;!l&&c<i.length;c+=2)i[c]!=null&&i[c+1]<o&&(l=!0);return l&&Ro(a,i,t),a}function To(t){let e=-1,o=!1;for(let n=0;n<t.childCount;n++){const s=t.child(n);let r=0;if(o)for(let i=0;i<n;i++){const a=t.child(i);for(let l=0;l<a.childCount;l++){const c=a.child(l);i+c.attrs.rowspan>n&&(r+=c.attrs.colspan)}}for(let i=0;i<s.childCount;i++){const a=s.child(i);r+=a.attrs.colspan,a.attrs.rowspan>1&&(o=!0)}e==-1?e=r:e!=r&&(e=Math.max(e,r))}return e}function Ro(t,e,o){t.problems||(t.problems=[]);const n={};for(let s=0;s<t.map.length;s++){const r=t.map[s];if(n[r])continue;n[r]=!0;const i=o.nodeAt(r);if(!i)throw new RangeError(`No cell with offset ${r} found`);let a=null;const l=i.attrs;for(let c=0;c<l.colspan;c++){const d=(s+c)%t.width,u=e[d*2];u!=null&&(!l.colwidth||l.colwidth[c]!=u)&&((a||(a=Io(l)))[c]=u)}a&&t.problems.unshift({type:"colwidth mismatch",pos:r,colwidth:a})}}function Io(t){if(t.colwidth)return t.colwidth.slice();const e=[];for(let o=0;o<t.colspan;o++)e.push(0);return e}function x(t){let e=t.cached.tableNodeTypes;if(!e){e=t.cached.tableNodeTypes={};for(const o in t.nodes){const n=t.nodes[o],s=n.spec.tableRole;s&&(e[s]=n)}}return e}var V=new ge("selectingCells");function Q(t){for(let e=t.depth-1;e>0;e--)if(t.node(e).type.spec.tableRole=="row")return t.node(0).resolve(t.before(e+1));return null}function Eo(t){for(let e=t.depth;e>0;e--){const o=t.node(e).type.spec.tableRole;if(o==="cell"||o==="header_cell")return t.node(e)}return null}function I(t){const e=t.selection.$head;for(let o=e.depth;o>0;o--)if(e.node(o).type.spec.tableRole=="row")return!0;return!1}function Ce(t){const e=t.selection;if("$anchorCell"in e&&e.$anchorCell)return e.$anchorCell.pos>e.$headCell.pos?e.$anchorCell:e.$headCell;if("node"in e&&e.node&&e.node.type.spec.tableRole=="cell")return e.$anchor;const o=Q(e.$head)||No(e.$head);if(o)return o;throw new RangeError(`No cell found around position ${e.head}`)}function No(t){for(let e=t.nodeAfter,o=t.pos;e;e=e.firstChild,o++){const n=e.type.spec.tableRole;if(n=="cell"||n=="header_cell")return t.doc.resolve(o)}for(let e=t.nodeBefore,o=t.pos;e;e=e.lastChild,o--){const n=e.type.spec.tableRole;if(n=="cell"||n=="header_cell")return t.doc.resolve(o-e.nodeSize)}}function Me(t){return t.parent.type.spec.tableRole=="row"&&!!t.nodeAfter}function Ho(t){return t.node(0).resolve(t.pos+t.nodeAfter.nodeSize)}function Ee(t,e){return t.depth==e.depth&&t.pos>=e.start(-1)&&t.pos<=e.end(-1)}function nt(t,e,o){const n=t.node(-1),s=k.get(n),r=t.start(-1),i=s.nextCell(t.pos-r,e,o);return i==null?null:t.node(0).resolve(r+i)}function Y(t,e,o=1){const n={...t,colspan:t.colspan-o};return n.colwidth&&(n.colwidth=n.colwidth.slice(),n.colwidth.splice(e,o),n.colwidth.some(s=>s>0)||(n.colwidth=null)),n}function st(t,e,o=1){const n={...t,colspan:t.colspan+o};if(n.colwidth){n.colwidth=n.colwidth.slice();for(let s=0;s<o;s++)n.colwidth.splice(e,0,0)}return n}function Bo(t,e,o){const n=x(e.type.schema).header_cell;for(let s=0;s<t.height;s++)if(e.nodeAt(t.map[o+s*t.width]).type!=n)return!1;return!0}var S=class z extends E{constructor(e,o=e){const n=e.node(-1),s=k.get(n),r=e.start(-1),i=s.rectBetween(e.pos-r,o.pos-r),a=e.node(0),l=s.cellsInRect(i).filter(d=>d!=o.pos-r);l.unshift(o.pos-r);const c=l.map(d=>{const u=n.nodeAt(d);if(!u)throw RangeError(`No cell with offset ${d} found`);const h=r+d+1;return new Qe(a.resolve(h),a.resolve(h+u.content.size))});super(c[0].$from,c[0].$to,c),this.$anchorCell=e,this.$headCell=o}map(e,o){const n=e.resolve(o.map(this.$anchorCell.pos)),s=e.resolve(o.map(this.$headCell.pos));if(Me(n)&&Me(s)&&Ee(n,s)){const r=this.$anchorCell.node(-1)!=n.node(-1);return r&&this.isRowSelection()?z.rowSelection(n,s):r&&this.isColSelection()?z.colSelection(n,s):new z(n,s)}return j.between(n,s)}content(){const e=this.$anchorCell.node(-1),o=k.get(e),n=this.$anchorCell.start(-1),s=o.rectBetween(this.$anchorCell.pos-n,this.$headCell.pos-n),r={},i=[];for(let l=s.top;l<s.bottom;l++){const c=[];for(let d=l*o.width+s.left,u=s.left;u<s.right;u++,d++){const h=o.map[d];if(r[h])continue;r[h]=!0;const f=o.findCell(h);let p=e.nodeAt(h);if(!p)throw RangeError(`No cell with offset ${h} found`);const g=s.left-f.left,w=f.right-s.right;if(g>0||w>0){let A=p.attrs;if(g>0&&(A=Y(A,0,g)),w>0&&(A=Y(A,A.colspan-w,w)),f.left<s.left){if(p=p.type.createAndFill(A),!p)throw RangeError(`Could not create cell with attrs ${JSON.stringify(A)}`)}else p=p.type.create(A,p.content)}if(f.top<s.top||f.bottom>s.bottom){const A={...p.attrs,rowspan:Math.min(f.bottom,s.bottom)-Math.max(f.top,s.top)};f.top<s.top?p=p.type.createAndFill(A):p=p.type.create(A,p.content)}c.push(p)}i.push(e.child(l).copy(N.from(c)))}const a=this.isColSelection()&&this.isRowSelection()?e:i;return new K(N.from(a),1,1)}replace(e,o=K.empty){const n=e.steps.length,s=this.ranges;for(let i=0;i<s.length;i++){const{$from:a,$to:l}=s[i],c=e.mapping.slice(n);e.replace(c.map(a.pos),c.map(l.pos),i?K.empty:o)}const r=E.findFrom(e.doc.resolve(e.mapping.slice(n).map(this.to)),-1);r&&e.setSelection(r)}replaceWith(e,o){this.replace(e,new K(N.from(o),0,0))}forEachCell(e){const o=this.$anchorCell.node(-1),n=k.get(o),s=this.$anchorCell.start(-1),r=n.cellsInRect(n.rectBetween(this.$anchorCell.pos-s,this.$headCell.pos-s));for(let i=0;i<r.length;i++)e(o.nodeAt(r[i]),s+r[i])}isColSelection(){const e=this.$anchorCell.index(-1),o=this.$headCell.index(-1);if(Math.min(e,o)>0)return!1;const n=e+this.$anchorCell.nodeAfter.attrs.rowspan,s=o+this.$headCell.nodeAfter.attrs.rowspan;return Math.max(n,s)==this.$headCell.node(-1).childCount}static colSelection(e,o=e){const n=e.node(-1),s=k.get(n),r=e.start(-1),i=s.findCell(e.pos-r),a=s.findCell(o.pos-r),l=e.node(0);return i.top<=a.top?(i.top>0&&(e=l.resolve(r+s.map[i.left])),a.bottom<s.height&&(o=l.resolve(r+s.map[s.width*(s.height-1)+a.right-1]))):(a.top>0&&(o=l.resolve(r+s.map[a.left])),i.bottom<s.height&&(e=l.resolve(r+s.map[s.width*(s.height-1)+i.right-1]))),new z(e,o)}isRowSelection(){const e=this.$anchorCell.node(-1),o=k.get(e),n=this.$anchorCell.start(-1),s=o.colCount(this.$anchorCell.pos-n),r=o.colCount(this.$headCell.pos-n);if(Math.min(s,r)>0)return!1;const i=s+this.$anchorCell.nodeAfter.attrs.colspan,a=r+this.$headCell.nodeAfter.attrs.colspan;return Math.max(i,a)==o.width}eq(e){return e instanceof z&&e.$anchorCell.pos==this.$anchorCell.pos&&e.$headCell.pos==this.$headCell.pos}static rowSelection(e,o=e){const n=e.node(-1),s=k.get(n),r=e.start(-1),i=s.findCell(e.pos-r),a=s.findCell(o.pos-r),l=e.node(0);return i.left<=a.left?(i.left>0&&(e=l.resolve(r+s.map[i.top*s.width])),a.right<s.width&&(o=l.resolve(r+s.map[s.width*(a.top+1)-1]))):(a.left>0&&(o=l.resolve(r+s.map[a.top*s.width])),i.right<s.width&&(e=l.resolve(r+s.map[s.width*(i.top+1)-1]))),new z(e,o)}toJSON(){return{type:"cell",anchor:this.$anchorCell.pos,head:this.$headCell.pos}}static fromJSON(e,o){return new z(e.resolve(o.anchor),e.resolve(o.head))}static create(e,o,n=o){return new z(e.resolve(o),e.resolve(n))}getBookmark(){return new Do(this.$anchorCell.pos,this.$headCell.pos)}};S.prototype.visible=!1;E.jsonID("cell",S);var Do=class rt{constructor(e,o){this.anchor=e,this.head=o}map(e){return new rt(e.map(this.anchor),e.map(this.head))}resolve(e){const o=e.resolve(this.anchor),n=e.resolve(this.head);return o.parent.type.spec.tableRole=="row"&&n.parent.type.spec.tableRole=="row"&&o.index()<o.parent.childCount&&n.index()<n.parent.childCount&&Ee(o,n)?new S(o,n):E.near(n,1)}};function Po(t){if(!(t.selection instanceof S))return null;const e=[];return t.selection.forEachCell((o,n)=>{e.push(Re.node(n,n+o.nodeSize,{class:"selectedCell"}))}),me.create(t.doc,e)}function $o({$from:t,$to:e}){if(t.pos==e.pos||t.pos<t.pos-6)return!1;let o=t.pos,n=e.pos,s=t.depth;for(;s>=0&&!(t.after(s+1)<t.end(s));s--,o++);for(let r=e.depth;r>=0&&!(e.before(r+1)>e.start(r));r--,n--);return o==n&&/row|table/.test(t.node(s).type.spec.tableRole)}function zo({$from:t,$to:e}){let o,n;for(let s=t.depth;s>0;s--){const r=t.node(s);if(r.type.spec.tableRole==="cell"||r.type.spec.tableRole==="header_cell"){o=r;break}}for(let s=e.depth;s>0;s--){const r=e.node(s);if(r.type.spec.tableRole==="cell"||r.type.spec.tableRole==="header_cell"){n=r;break}}return o!==n&&e.parentOffset===0}function jo(t,e,o){const n=(e||t).selection,s=(e||t).doc;let r,i;if(n instanceof Je&&(i=n.node.type.spec.tableRole)){if(i=="cell"||i=="header_cell")r=S.create(s,n.from);else if(i=="row"){const a=s.resolve(n.from+1);r=S.rowSelection(a,a)}else if(!o){const a=k.get(n.node),l=n.from+1,c=l+a.map[a.width*a.height-1];r=S.create(s,l+1,c)}}else n instanceof j&&$o(n)?r=j.create(s,n.from):n instanceof j&&zo(n)&&(r=j.create(s,n.$from.start(),n.$from.end()));return r&&(e||(e=t.tr)).setSelection(r),e}var Oo=new ge("fix-tables");function it(t,e,o,n){const s=t.childCount,r=e.childCount;e:for(let i=0,a=0;i<r;i++){const l=e.child(i);for(let c=a,d=Math.min(s,i+3);c<d;c++)if(t.child(c)==l){a=c+1,o+=l.nodeSize;continue e}n(l,o),a<s&&t.child(a).sameMarkup(l)?it(t.child(a),l,o+1,n):l.nodesBetween(0,l.content.size,n,o+1),o+=l.nodeSize}}function lt(t,e){let o;const n=(s,r)=>{s.type.spec.tableRole=="table"&&(o=Wo(t,s,r,o))};return e?e.doc!=t.doc&&it(e.doc,t.doc,0,n):t.doc.descendants(n),o}function Wo(t,e,o,n){const s=k.get(e);if(!s.problems)return n;n||(n=t.tr);const r=[];for(let l=0;l<s.height;l++)r.push(0);for(let l=0;l<s.problems.length;l++){const c=s.problems[l];if(c.type=="collision"){const d=e.nodeAt(c.pos);if(!d)continue;const u=d.attrs;for(let h=0;h<u.rowspan;h++)r[c.row+h]+=c.n;n.setNodeMarkup(n.mapping.map(o+1+c.pos),null,Y(u,u.colspan-c.n,c.n))}else if(c.type=="missing")r[c.row]+=c.n;else if(c.type=="overlong_rowspan"){const d=e.nodeAt(c.pos);if(!d)continue;n.setNodeMarkup(n.mapping.map(o+1+c.pos),null,{...d.attrs,rowspan:d.attrs.rowspan-c.n})}else if(c.type=="colwidth mismatch"){const d=e.nodeAt(c.pos);if(!d)continue;n.setNodeMarkup(n.mapping.map(o+1+c.pos),null,{...d.attrs,colwidth:c.colwidth})}}let i,a;for(let l=0;l<r.length;l++)r[l]&&(i==null&&(i=l),a=l);for(let l=0,c=o+1;l<s.height;l++){const d=e.child(l),u=c+d.nodeSize,h=r[l];if(h>0){let f="cell";d.firstChild&&(f=d.firstChild.type.spec.tableRole);const p=[];for(let w=0;w<h;w++){const A=x(t.schema)[f].createAndFill();A&&p.push(A)}const g=(l==0||i==l-1)&&a==l?c+1:u-1;n.insert(n.mapping.map(g),p)}c=u}return n.setMeta(Oo,{fixTables:!0})}function Fo(t){if(!t.size)return null;let{content:e,openStart:o,openEnd:n}=t;for(;e.childCount==1&&(o>0&&n>0||e.child(0).type.spec.tableRole=="table");)o--,n--,e=e.child(0).content;const s=e.child(0),r=s.type.spec.tableRole,i=s.type.schema,a=[];if(r=="row")for(let l=0;l<e.childCount;l++){let c=e.child(l).content;const d=l?0:Math.max(0,o-1),u=l<e.childCount-1?0:Math.max(0,n-1);(d||u)&&(c=xe(x(i).row,new K(c,d,u)).content),a.push(c)}else if(r=="cell"||r=="header_cell")a.push(o||n?xe(x(i).row,new K(e,o,n)).content:e);else return null;return Vo(i,a)}function Vo(t,e){const o=[];for(let s=0;s<e.length;s++){const r=e[s];for(let i=r.childCount-1;i>=0;i--){const{rowspan:a,colspan:l}=r.child(i).attrs;for(let c=s;c<s+a;c++)o[c]=(o[c]||0)+l}}let n=0;for(let s=0;s<o.length;s++)n=Math.max(n,o[s]);for(let s=0;s<o.length;s++)if(s>=e.length&&e.push(N.empty),o[s]<n){const r=x(t).cell.createAndFill(),i=[];for(let a=o[s];a<n;a++)i.push(r);e[s]=e[s].append(N.from(i))}return{height:e.length,width:n,rows:e}}function xe(t,e){const o=t.createAndFill();return new to(o).replace(0,o.content.size,e).doc}function Ko({width:t,height:e,rows:o},n,s){if(t!=n){const r=[],i=[];for(let a=0;a<o.length;a++){const l=o[a],c=[];for(let d=r[a]||0,u=0;d<n;u++){let h=l.child(u%l.childCount);d+h.attrs.colspan>n&&(h=h.type.createChecked(Y(h.attrs,h.attrs.colspan,d+h.attrs.colspan-n),h.content)),c.push(h),d+=h.attrs.colspan;for(let f=1;f<h.attrs.rowspan;f++)r[a+f]=(r[a+f]||0)+h.attrs.colspan}i.push(N.from(c))}o=i,t=n}if(e!=s){const r=[];for(let i=0,a=0;i<s;i++,a++){const l=[],c=o[a%e];for(let d=0;d<c.childCount;d++){let u=c.child(d);i+u.attrs.rowspan>s&&(u=u.type.create({...u.attrs,rowspan:Math.max(1,s-u.attrs.rowspan)},u.content)),l.push(u)}r.push(N.from(l))}o=r,e=s}return{width:t,height:e,rows:o}}function qo(t,e,o,n,s,r,i){const a=t.doc.type.schema,l=x(a);let c,d;if(s>e.width)for(let u=0,h=0;u<e.height;u++){const f=o.child(u);h+=f.nodeSize;const p=[];let g;f.lastChild==null||f.lastChild.type==l.cell?g=c||(c=l.cell.createAndFill()):g=d||(d=l.header_cell.createAndFill());for(let w=e.width;w<s;w++)p.push(g);t.insert(t.mapping.slice(i).map(h-1+n),p)}if(r>e.height){const u=[];for(let p=0,g=(e.height-1)*e.width;p<Math.max(e.width,s);p++){const w=p>=e.width?!1:o.nodeAt(e.map[g+p]).type==l.header_cell;u.push(w?d||(d=l.header_cell.createAndFill()):c||(c=l.cell.createAndFill()))}const h=l.row.create(null,N.from(u)),f=[];for(let p=e.height;p<r;p++)f.push(h);t.insert(t.mapping.slice(i).map(n+o.nodeSize-2),f)}return!!(c||d)}function $e(t,e,o,n,s,r,i,a){if(i==0||i==e.height)return!1;let l=!1;for(let c=s;c<r;c++){const d=i*e.width+c,u=e.map[d];if(e.map[d-e.width]==u){l=!0;const h=o.nodeAt(u),{top:f,left:p}=e.findCell(u);t.setNodeMarkup(t.mapping.slice(a).map(u+n),null,{...h.attrs,rowspan:i-f}),t.insert(t.mapping.slice(a).map(e.positionAt(i,p,o)),h.type.createAndFill({...h.attrs,rowspan:f+h.attrs.rowspan-i})),c+=h.attrs.colspan-1}}return l}function ze(t,e,o,n,s,r,i,a){if(i==0||i==e.width)return!1;let l=!1;for(let c=s;c<r;c++){const d=c*e.width+i,u=e.map[d];if(e.map[d-1]==u){l=!0;const h=o.nodeAt(u),f=e.colCount(u),p=t.mapping.slice(a).map(u+n);t.setNodeMarkup(p,null,Y(h.attrs,i-f,h.attrs.colspan-(i-f))),t.insert(p+h.nodeSize,h.type.createAndFill(Y(h.attrs,0,i-f))),c+=h.attrs.rowspan-1}}return l}function je(t,e,o,n,s){let r=o?t.doc.nodeAt(o-1):t.doc;if(!r)throw new Error("No table found");let i=k.get(r);const{top:a,left:l}=n,c=l+s.width,d=a+s.height,u=t.tr;let h=0;function f(){if(r=o?u.doc.nodeAt(o-1):u.doc,!r)throw new Error("No table found");i=k.get(r),h=u.mapping.maps.length}qo(u,i,r,o,c,d,h)&&f(),$e(u,i,r,o,l,c,a,h)&&f(),$e(u,i,r,o,l,c,d,h)&&f(),ze(u,i,r,o,a,d,l,h)&&f(),ze(u,i,r,o,a,d,c,h)&&f();for(let p=a;p<d;p++){const g=i.positionAt(p,l,r),w=i.positionAt(p,c,r);u.replace(u.mapping.slice(h).map(g+o),u.mapping.slice(h).map(w+o),new K(s.rows[p-a],0,0))}f(),u.setSelection(new S(u.doc.resolve(o+i.positionAt(a,l,r)),u.doc.resolve(o+i.positionAt(d-1,c-1,r)))),e(u)}var Uo=eo({ArrowLeft:ce("horiz",-1),ArrowRight:ce("horiz",1),ArrowUp:ce("vert",-1),ArrowDown:ce("vert",1),"Shift-ArrowLeft":de("horiz",-1),"Shift-ArrowRight":de("horiz",1),"Shift-ArrowUp":de("vert",-1),"Shift-ArrowDown":de("vert",1),Backspace:ue,"Mod-Backspace":ue,Delete:ue,"Mod-Delete":ue});function fe(t,e,o){return o.eq(t.selection)?!1:(e&&e(t.tr.setSelection(o).scrollIntoView()),!0)}function ce(t,e){return(o,n,s)=>{if(!s)return!1;const r=o.selection;if(r instanceof S)return fe(o,n,E.near(r.$headCell,e));if(t!="horiz"&&!r.empty)return!1;const i=at(s,t,e);if(i==null)return!1;if(t=="horiz")return fe(o,n,E.near(o.doc.resolve(r.head+e),e));{const a=o.doc.resolve(i),l=nt(a,t,e);let c;return l?c=E.near(l,1):e<0?c=E.near(o.doc.resolve(a.before(-1)),-1):c=E.near(o.doc.resolve(a.after(-1)),1),fe(o,n,c)}}}function de(t,e){return(o,n,s)=>{if(!s)return!1;const r=o.selection;let i;if(r instanceof S)i=r;else{const l=at(s,t,e);if(l==null)return!1;i=new S(o.doc.resolve(l))}const a=nt(i.$headCell,t,e);return a?fe(o,n,new S(i.$anchorCell,a)):!1}}function ue(t,e){const o=t.selection;if(!(o instanceof S))return!1;if(e){const n=t.tr,s=x(t.schema).cell.createAndFill().content;o.forEachCell((r,i)=>{r.content.eq(s)||n.replace(n.mapping.map(i+1),n.mapping.map(i+r.nodeSize-1),new K(s,0,0))}),n.docChanged&&e(n)}return!0}function Go(t,e){const o=t.state.doc,n=Q(o.resolve(e));return n?(t.dispatch(t.state.tr.setSelection(new S(n))),!0):!1}function Xo(t,e,o){if(!I(t.state))return!1;let n=Fo(o);const s=t.state.selection;if(s instanceof S){n||(n={width:1,height:1,rows:[N.from(xe(x(t.state.schema).cell,o))]});const r=s.$anchorCell.node(-1),i=s.$anchorCell.start(-1),a=k.get(r).rectBetween(s.$anchorCell.pos-i,s.$headCell.pos-i);return n=Ko(n,a.right-a.left,a.bottom-a.top),je(t.state,t.dispatch,i,a,n),!0}else if(n){const r=Ce(t.state),i=r.start(-1);return je(t.state,t.dispatch,i,k.get(r.node(-1)).findCell(r.pos-i),n),!0}else return!1}function Yo(t,e){var o;if(e.ctrlKey||e.metaKey)return;const n=Oe(t,e.target);let s;if(e.shiftKey&&t.state.selection instanceof S)r(t.state.selection.$anchorCell,e),e.preventDefault();else if(e.shiftKey&&n&&(s=Q(t.state.selection.$anchor))!=null&&((o=_e(t,e))==null?void 0:o.pos)!=s.pos)r(s,e),e.preventDefault();else if(!n)return;function r(l,c){let d=_e(t,c);const u=V.getState(t.state)==null;if(!d||!Ee(l,d))if(u)d=l;else return;const h=new S(l,d);if(u||!t.state.selection.eq(h)){const f=t.state.tr.setSelection(h);u&&f.setMeta(V,l.pos),t.dispatch(f)}}function i(){t.root.removeEventListener("mouseup",i),t.root.removeEventListener("dragstart",i),t.root.removeEventListener("mousemove",a),V.getState(t.state)!=null&&t.dispatch(t.state.tr.setMeta(V,-1))}function a(l){const c=l,d=V.getState(t.state);let u;if(d!=null)u=t.state.doc.resolve(d);else if(Oe(t,c.target)!=n&&(u=_e(t,e),!u))return i();u&&r(u,c)}t.root.addEventListener("mouseup",i),t.root.addEventListener("dragstart",i),t.root.addEventListener("mousemove",a)}function at(t,e,o){if(!(t.state.selection instanceof j))return null;const{$head:n}=t.state.selection;for(let s=n.depth-1;s>=0;s--){const r=n.node(s);if((o<0?n.index(s):n.indexAfter(s))!=(o<0?0:r.childCount))return null;if(r.type.spec.tableRole=="cell"||r.type.spec.tableRole=="header_cell"){const a=n.before(s),l=e=="vert"?o>0?"down":"up":o>0?"right":"left";return t.endOfTextblock(l)?a:null}}return null}function Oe(t,e){for(;e&&e!=t.dom;e=e.parentNode)if(e.nodeName=="TD"||e.nodeName=="TH")return e;return null}function _e(t,e){const o=t.posAtCoords({left:e.clientX,top:e.clientY});return o&&o?Q(t.state.doc.resolve(o.pos)):null}var Jo=class{constructor(e,o){this.node=e,this.cellMinWidth=o,this.dom=document.createElement("div"),this.dom.className="tableWrapper",this.table=this.dom.appendChild(document.createElement("table")),this.colgroup=this.table.appendChild(document.createElement("colgroup")),Le(e,this.colgroup,this.table,o),this.contentDOM=this.table.appendChild(document.createElement("tbody"))}update(e){return e.type!=this.node.type?!1:(this.node=e,Le(e,this.colgroup,this.table,this.cellMinWidth),!0)}ignoreMutation(e){return e.type=="attributes"&&(e.target==this.table||this.colgroup.contains(e.target))}};function Le(t,e,o,n,s,r){var i;let a=0,l=!0,c=e.firstChild;const d=t.firstChild;if(d){for(let u=0,h=0;u<d.childCount;u++){const{colspan:f,colwidth:p}=d.child(u).attrs;for(let g=0;g<f;g++,h++){const w=s==h?r:p&&p[g],A=w?w+"px":"";a+=w||n,w||(l=!1),c?(c.style.width!=A&&(c.style.width=A),c=c.nextSibling):e.appendChild(document.createElement("col")).style.width=A}}for(;c;){const u=c.nextSibling;(i=c.parentNode)==null||i.removeChild(c),c=u}l?(o.style.width=a+"px",o.style.minWidth=""):(o.style.width="",o.style.minWidth=a+"px")}}var R=new ge("tableColumnResizing");function Qo({handleWidth:t=5,cellMinWidth:e=25,View:o=Jo,lastColumnResizable:n=!0}={}){const s=new Te({key:R,state:{init(r,i){return s.spec.props.nodeViews[x(i.schema).table.name]=(a,l)=>new o(a,e,l),new Zo(-1,!1)},apply(r,i){return i.apply(r)}},props:{attributes:r=>{const i=R.getState(r);return i&&i.activeHandle>-1?{class:"resize-cursor"}:{}},handleDOMEvents:{mousemove:(r,i)=>{en(r,i,t,e,n)},mouseleave:r=>{tn(r)},mousedown:(r,i)=>{on(r,i,e)}},decorations:r=>{const i=R.getState(r);if(i&&i.activeHandle>-1)return cn(r,i.activeHandle)},nodeViews:{}}});return s}var Zo=class pe{constructor(e,o){this.activeHandle=e,this.dragging=o}apply(e){const o=this,n=e.getMeta(R);if(n&&n.setHandle!=null)return new pe(n.setHandle,!1);if(n&&n.setDragging!==void 0)return new pe(o.activeHandle,n.setDragging);if(o.activeHandle>-1&&e.docChanged){let s=e.mapping.map(o.activeHandle,-1);return Me(e.doc.resolve(s))||(s=-1),new pe(s,o.dragging)}return o}};function en(t,e,o,n,s){const r=R.getState(t.state);if(r&&!r.dragging){const i=sn(e.target);let a=-1;if(i){const{left:l,right:c}=i.getBoundingClientRect();e.clientX-l<=o?a=We(t,e,"left",o):c-e.clientX<=o&&(a=We(t,e,"right",o))}if(a!=r.activeHandle){if(!s&&a!==-1){const l=t.state.doc.resolve(a),c=l.node(-1),d=k.get(c),u=l.start(-1);if(d.colCount(l.pos-u)+l.nodeAfter.attrs.colspan-1==d.width-1)return}ct(t,a)}}}function tn(t){const e=R.getState(t.state);e&&e.activeHandle>-1&&!e.dragging&&ct(t,-1)}function on(t,e,o){var n;const s=(n=t.dom.ownerDocument.defaultView)!=null?n:window,r=R.getState(t.state);if(!r||r.activeHandle==-1||r.dragging)return!1;const i=t.state.doc.nodeAt(r.activeHandle),a=nn(t,r.activeHandle,i.attrs);t.dispatch(t.state.tr.setMeta(R,{setDragging:{startX:e.clientX,startWidth:a}}));function l(d){s.removeEventListener("mouseup",l),s.removeEventListener("mousemove",c);const u=R.getState(t.state);u!=null&&u.dragging&&(rn(t,u.activeHandle,Fe(u.dragging,d,o)),t.dispatch(t.state.tr.setMeta(R,{setDragging:null})))}function c(d){if(!d.which)return l(d);const u=R.getState(t.state);if(u&&u.dragging){const h=Fe(u.dragging,d,o);ln(t,u.activeHandle,h,o)}}return s.addEventListener("mouseup",l),s.addEventListener("mousemove",c),e.preventDefault(),!0}function nn(t,e,{colspan:o,colwidth:n}){const s=n&&n[n.length-1];if(s)return s;const r=t.domAtPos(e);let a=r.node.childNodes[r.offset].offsetWidth,l=o;if(n)for(let c=0;c<o;c++)n[c]&&(a-=n[c],l--);return a/l}function sn(t){for(;t&&t.nodeName!="TD"&&t.nodeName!="TH";)t=t.classList&&t.classList.contains("ProseMirror")?null:t.parentNode;return t}function We(t,e,o,n){const s=o=="right"?-n:n,r=t.posAtCoords({left:e.clientX+s,top:e.clientY});if(!r)return-1;const{pos:i}=r,a=Q(t.state.doc.resolve(i));if(!a)return-1;if(o=="right")return a.pos;const l=k.get(a.node(-1)),c=a.start(-1),d=l.map.indexOf(a.pos-c);return d%l.width==0?-1:c+l.map[d-1]}function Fe(t,e,o){const n=e.clientX-t.startX;return Math.max(o,t.startWidth+n)}function ct(t,e){t.dispatch(t.state.tr.setMeta(R,{setHandle:e}))}function rn(t,e,o){const n=t.state.doc.resolve(e),s=n.node(-1),r=k.get(s),i=n.start(-1),a=r.colCount(n.pos-i)+n.nodeAfter.attrs.colspan-1,l=t.state.tr;for(let c=0;c<r.height;c++){const d=c*r.width+a;if(c&&r.map[d]==r.map[d-r.width])continue;const u=r.map[d],h=s.nodeAt(u).attrs,f=h.colspan==1?0:a-r.colCount(u);if(h.colwidth&&h.colwidth[f]==o)continue;const p=h.colwidth?h.colwidth.slice():an(h.colspan);p[f]=o,l.setNodeMarkup(i+u,null,{...h,colwidth:p})}l.docChanged&&t.dispatch(l)}function ln(t,e,o,n){const s=t.state.doc.resolve(e),r=s.node(-1),i=s.start(-1),a=k.get(r).colCount(s.pos-i)+s.nodeAfter.attrs.colspan-1;let l=t.domAtPos(s.start(-1)).node;for(;l&&l.nodeName!="TABLE";)l=l.parentNode;l&&Le(r,l.firstChild,l,n,a,o)}function an(t){return Array(t).fill(0)}function cn(t,e){const o=[],n=t.doc.resolve(e),s=n.node(-1);if(!s)return me.empty;const r=k.get(s),i=n.start(-1),a=r.colCount(n.pos-i)+n.nodeAfter.attrs.colspan;for(let l=0;l<r.height;l++){const c=a+l*r.width-1;if((a==r.width||r.map[c]!=r.map[c+1])&&(l==0||r.map[c]!=r.map[c-r.width])){const d=r.map[c],u=i+d+s.nodeAt(d).nodeSize-1,h=document.createElement("div");h.className="column-resize-handle",o.push(Re.widget(u,h))}}return me.create(t.doc,o)}function H(t){const e=t.selection,o=Ce(t),n=o.node(-1),s=o.start(-1),r=k.get(n);return{...e instanceof S?r.rectBetween(e.$anchorCell.pos-s,e.$headCell.pos-s):r.findCell(o.pos-s),tableStart:s,map:r,table:n}}function dt(t,{map:e,tableStart:o,table:n},s){let r=s>0?-1:0;Bo(e,n,s+r)&&(r=s==0||s==e.width?null:0);for(let i=0;i<e.height;i++){const a=i*e.width+s;if(s>0&&s<e.width&&e.map[a-1]==e.map[a]){const l=e.map[a],c=n.nodeAt(l);t.setNodeMarkup(t.mapping.map(o+l),null,st(c.attrs,s-e.colCount(l))),i+=c.attrs.rowspan-1}else{const l=r==null?x(n.type.schema).cell:n.nodeAt(e.map[a+r]).type,c=e.positionAt(i,s,n);t.insert(t.mapping.map(o+c),l.createAndFill())}}return t}function dn(t,e){if(!I(t))return!1;if(e){const o=H(t);e(dt(t.tr,o,o.left))}return!0}function un(t,e){if(!I(t))return!1;if(e){const o=H(t);e(dt(t.tr,o,o.right))}return!0}function hn(t,{map:e,table:o,tableStart:n},s){const r=t.mapping.maps.length;for(let i=0;i<e.height;){const a=i*e.width+s,l=e.map[a],c=o.nodeAt(l),d=c.attrs;if(s>0&&e.map[a-1]==l||s<e.width-1&&e.map[a+1]==l)t.setNodeMarkup(t.mapping.slice(r).map(n+l),null,Y(d,s-e.colCount(l)));else{const u=t.mapping.slice(r).map(n+l);t.delete(u,u+c.nodeSize)}i+=d.rowspan}}function fn(t,e){if(!I(t))return!1;if(e){const o=H(t),n=t.tr;if(o.left==0&&o.right==o.map.width)return!1;for(let s=o.right-1;hn(n,o,s),s!=o.left;s--){const r=o.tableStart?n.doc.nodeAt(o.tableStart-1):n.doc;if(!r)throw RangeError("No table found");o.table=r,o.map=k.get(r)}e(n)}return!0}function pn(t,e,o){var n;const s=x(e.type.schema).header_cell;for(let r=0;r<t.width;r++)if(((n=e.nodeAt(t.map[r+o*t.width]))==null?void 0:n.type)!=s)return!1;return!0}function ut(t,{map:e,tableStart:o,table:n},s){var r;let i=o;for(let c=0;c<s;c++)i+=n.child(c).nodeSize;const a=[];let l=s>0?-1:0;pn(e,n,s+l)&&(l=s==0||s==e.height?null:0);for(let c=0,d=e.width*s;c<e.width;c++,d++)if(s>0&&s<e.height&&e.map[d]==e.map[d-e.width]){const u=e.map[d],h=n.nodeAt(u).attrs;t.setNodeMarkup(o+u,null,{...h,rowspan:h.rowspan+1}),c+=h.colspan-1}else{const u=l==null?x(n.type.schema).cell:(r=n.nodeAt(e.map[d+l*e.width]))==null?void 0:r.type,h=u==null?void 0:u.createAndFill();h&&a.push(h)}return t.insert(i,x(n.type.schema).row.create(null,a)),t}function mn(t,e){if(!I(t))return!1;if(e){const o=H(t);e(ut(t.tr,o,o.top))}return!0}function gn(t,e){if(!I(t))return!1;if(e){const o=H(t);e(ut(t.tr,o,o.bottom))}return!0}function bn(t,{map:e,table:o,tableStart:n},s){let r=0;for(let c=0;c<s;c++)r+=o.child(c).nodeSize;const i=r+o.child(s).nodeSize,a=t.mapping.maps.length;t.delete(r+n,i+n);const l=new Set;for(let c=0,d=s*e.width;c<e.width;c++,d++){const u=e.map[d];if(!l.has(u)){if(l.add(u),s>0&&u==e.map[d-e.width]){const h=o.nodeAt(u).attrs;t.setNodeMarkup(t.mapping.slice(a).map(u+n),null,{...h,rowspan:h.rowspan-1}),c+=h.colspan-1}else if(s<e.height&&u==e.map[d+e.width]){const h=o.nodeAt(u),f=h.attrs,p=h.type.create({...f,rowspan:h.attrs.rowspan-1},h.content),g=e.positionAt(s+1,c,o);t.insert(t.mapping.slice(a).map(n+g),p),c+=f.colspan-1}}}}function wn(t,e){if(!I(t))return!1;if(e){const o=H(t),n=t.tr;if(o.top==0&&o.bottom==o.map.height)return!1;for(let s=o.bottom-1;bn(n,o,s),s!=o.top;s--){const r=o.tableStart?n.doc.nodeAt(o.tableStart-1):n.doc;if(!r)throw RangeError("No table found");o.table=r,o.map=k.get(o.table)}e(n)}return!0}function Ve(t){const e=t.content;return e.childCount==1&&e.child(0).isTextblock&&e.child(0).childCount==0}function yn({width:t,height:e,map:o},n){let s=n.top*t+n.left,r=s,i=(n.bottom-1)*t+n.left,a=s+(n.right-n.left-1);for(let l=n.top;l<n.bottom;l++){if(n.left>0&&o[r]==o[r-1]||n.right<t&&o[a]==o[a+1])return!0;r+=t,a+=t}for(let l=n.left;l<n.right;l++){if(n.top>0&&o[s]==o[s-t]||n.bottom<e&&o[i]==o[i+t])return!0;s++,i++}return!1}function Ke(t,e){const o=t.selection;if(!(o instanceof S)||o.$anchorCell.pos==o.$headCell.pos)return!1;const n=H(t),{map:s}=n;if(yn(s,n))return!1;if(e){const r=t.tr,i={};let a=N.empty,l,c;for(let d=n.top;d<n.bottom;d++)for(let u=n.left;u<n.right;u++){const h=s.map[d*s.width+u],f=n.table.nodeAt(h);if(!(i[h]||!f))if(i[h]=!0,l==null)l=h,c=f;else{Ve(f)||(a=a.append(f.content));const p=r.mapping.map(h+n.tableStart);r.delete(p,p+f.nodeSize)}}if(l==null||c==null)return!0;if(r.setNodeMarkup(l+n.tableStart,null,{...st(c.attrs,c.attrs.colspan,n.right-n.left-c.attrs.colspan),rowspan:n.bottom-n.top}),a.size){const d=l+1+c.content.size,u=Ve(c)?l+1:d;r.replaceWith(u+n.tableStart,d+n.tableStart,a)}r.setSelection(new S(r.doc.resolve(l+n.tableStart))),e(r)}return!0}function qe(t,e){const o=x(t.schema);return Cn(({node:n})=>o[n.type.spec.tableRole])(t,e)}function Cn(t){return(e,o)=>{var n;const s=e.selection;let r,i;if(s instanceof S){if(s.$anchorCell.pos!=s.$headCell.pos)return!1;r=s.$anchorCell.nodeAfter,i=s.$anchorCell.pos}else{if(r=Eo(s.$from),!r)return!1;i=(n=Q(s.$from))==null?void 0:n.pos}if(r==null||i==null||r.attrs.colspan==1&&r.attrs.rowspan==1)return!1;if(o){let a=r.attrs;const l=[],c=a.colwidth;a.rowspan>1&&(a={...a,rowspan:1}),a.colspan>1&&(a={...a,colspan:1});const d=H(e),u=e.tr;for(let f=0;f<d.right-d.left;f++)l.push(c?{...a,colwidth:c&&c[f]?[c[f]]:null}:a);let h;for(let f=d.top;f<d.bottom;f++){let p=d.map.positionAt(f,d.left,d.table);f==d.top&&(p+=r.nodeSize);for(let g=d.left,w=0;g<d.right;g++,w++)g==d.left&&f==d.top||u.insert(h=u.mapping.map(p+d.tableStart,1),t({node:r,row:f,col:g}).createAndFill(l[w]))}u.setNodeMarkup(i,t({node:r,row:d.top,col:d.left}),l[0]),s instanceof S&&u.setSelection(new S(u.doc.resolve(s.$anchorCell.pos),h?u.doc.resolve(h):void 0)),o(u)}return!0}}function vn(t,e){return function(o,n){if(!I(o))return!1;const s=Ce(o);if(s.nodeAfter.attrs[t]===e)return!1;if(n){const r=o.tr;o.selection instanceof S?o.selection.forEachCell((i,a)=>{i.attrs[t]!==e&&r.setNodeMarkup(a,null,{...i.attrs,[t]:e})}):r.setNodeMarkup(s.pos,null,{...s.nodeAfter.attrs,[t]:e}),n(r)}return!0}}function An(t){return function(e,o){if(!I(e))return!1;if(o){const n=x(e.schema),s=H(e),r=e.tr,i=s.map.cellsInRect(t=="column"?{left:s.left,top:0,right:s.right,bottom:s.map.height}:t=="row"?{left:0,top:s.top,right:s.map.width,bottom:s.bottom}:s),a=i.map(l=>s.table.nodeAt(l));for(let l=0;l<i.length;l++)a[l].type==n.header_cell&&r.setNodeMarkup(s.tableStart+i[l],n.cell,a[l].attrs);if(r.steps.length==0)for(let l=0;l<i.length;l++)r.setNodeMarkup(s.tableStart+i[l],n.header_cell,a[l].attrs);o(r)}return!0}}function Ue(t,e,o){const n=e.map.cellsInRect({left:0,top:0,right:t=="row"?e.map.width:1,bottom:t=="column"?e.map.height:1});for(let s=0;s<n.length;s++){const r=e.table.nodeAt(n[s]);if(r&&r.type!==o.header_cell)return!1}return!0}function ne(t,e){return e=e||{useDeprecatedLogic:!1},e.useDeprecatedLogic?An(t):function(o,n){if(!I(o))return!1;if(n){const s=x(o.schema),r=H(o),i=o.tr,a=Ue("row",r,s),l=Ue("column",r,s),d=(t==="column"?a:t==="row"?l:!1)?1:0,u=t=="column"?{left:0,top:d,right:1,bottom:r.map.height}:t=="row"?{left:d,top:0,right:r.map.width,bottom:1}:r,h=t=="column"?l?s.cell:s.header_cell:t=="row"?a?s.cell:s.header_cell:s.cell;r.map.cellsInRect(u).forEach(f=>{const p=f+r.tableStart,g=i.doc.nodeAt(p);g&&i.setNodeMarkup(p,h,g.attrs)}),n(i)}return!0}}ne("row",{useDeprecatedLogic:!0});ne("column",{useDeprecatedLogic:!0});var _n=ne("cell",{useDeprecatedLogic:!0});function Sn(t,e){if(e<0){const o=t.nodeBefore;if(o)return t.pos-o.nodeSize;for(let n=t.index(-1)-1,s=t.before();n>=0;n--){const r=t.node(-1).child(n),i=r.lastChild;if(i)return s-1-i.nodeSize;s-=r.nodeSize}}else{if(t.index()<t.parent.childCount-1)return t.pos+t.nodeAfter.nodeSize;const o=t.node(-1);for(let n=t.indexAfter(-1),s=t.after();n<o.childCount;n++){const r=o.child(n);if(r.childCount)return s+1;s+=r.nodeSize}}return null}function Ge(t){return function(e,o){if(!I(e))return!1;const n=Sn(Ce(e),t);if(n==null)return!1;if(o){const s=e.doc.resolve(n);o(e.tr.setSelection(j.between(s,Ho(s))).scrollIntoView())}return!0}}function kn(t,e){const o=t.selection.$anchor;for(let n=o.depth;n>0;n--)if(o.node(n).type.spec.tableRole=="table")return e&&e(t.tr.delete(o.before(n),o.after(n)).scrollIntoView()),!0;return!1}function Mn({allowTableNodeSelection:t=!1}={}){return new Te({key:V,state:{init(){return null},apply(e,o){const n=e.getMeta(V);if(n!=null)return n==-1?null:n;if(o==null||!e.docChanged)return o;const{deleted:s,pos:r}=e.mapping.mapResult(o);return s?null:r}},props:{decorations:Po,handleDOMEvents:{mousedown:Yo},createSelectionBetween(e){return V.getState(e.state)!=null?e.state.selection:null},handleTripleClick:Go,handleKeyDown:Uo,handlePaste:Xo},appendTransaction(e,o,n){return jo(n,lt(n,o),t)}})}function Xe(t,e,o,n,s,r){let i=0,a=!0,l=e.firstChild;const c=t.firstChild;for(let d=0,u=0;d<c.childCount;d+=1){const{colspan:h,colwidth:f}=c.child(d).attrs;for(let p=0;p<h;p+=1,u+=1){const g=s===u?r:f&&f[p],w=g?`${g}px`:"";i+=g||n,g||(a=!1),l?(l.style.width!==w&&(l.style.width=w),l=l.nextSibling):e.appendChild(document.createElement("col")).style.width=w}}for(;l;){const d=l.nextSibling;l.parentNode.removeChild(l),l=d}a?(o.style.width=`${i}px`,o.style.minWidth=""):(o.style.width="",o.style.minWidth=`${i}px`)}class xn{constructor(e,o){this.node=e,this.cellMinWidth=o,this.dom=document.createElement("div"),this.dom.className="tableWrapper",this.table=this.dom.appendChild(document.createElement("table")),this.colgroup=this.table.appendChild(document.createElement("colgroup")),Xe(e,this.colgroup,this.table,o),this.contentDOM=this.table.appendChild(document.createElement("tbody"))}update(e){return e.type!==this.node.type?!1:(this.node=e,Xe(e,this.colgroup,this.table,this.cellMinWidth),!0)}ignoreMutation(e){return e.type==="attributes"&&(e.target===this.table||this.colgroup.contains(e.target))}}function Ln(t,e,o,n){let s=0,r=!0;const i=[],a=t.firstChild;if(!a)return{};for(let u=0,h=0;u<a.childCount;u+=1){const{colspan:f,colwidth:p}=a.child(u).attrs;for(let g=0;g<f;g+=1,h+=1){const w=o===h?n:p&&p[g],A=w?`${w}px`:"";s+=w||e,w||(r=!1),i.push(["col",A?{style:`width: ${A}`}:{}])}}const l=r?`${s}px`:"",c=r?"":`${s}px`;return{colgroup:["colgroup",{},...i],tableWidth:l,tableMinWidth:c}}function Ye(t,e){return e?t.createChecked(null,e):t.createAndFill()}function Tn(t){if(t.cached.tableNodeTypes)return t.cached.tableNodeTypes;const e={};return Object.keys(t.nodes).forEach(o=>{const n=t.nodes[o];n.spec.tableRole&&(e[n.spec.tableRole]=n)}),t.cached.tableNodeTypes=e,e}function Rn(t,e,o,n,s){const r=Tn(t),i=[],a=[];for(let c=0;c<o;c+=1){const d=Ye(r.cell,s);if(d&&a.push(d),n){const u=Ye(r.header_cell,s);u&&i.push(u)}}const l=[];for(let c=0;c<e;c+=1)l.push(r.row.createChecked(null,n&&c===0?i:a));return r.table.createChecked(null,l)}function In(t){return t instanceof S}const he=({editor:t})=>{const{selection:e}=t.state;if(!In(e))return!1;let o=0;const n=so(e.ranges[0].$from,r=>r.type.name==="table");return n==null||n.node.descendants(r=>{if(r.type.name==="table")return!1;["tableCell","tableHeader"].includes(r.type.name)&&(o+=1)}),o===e.ranges.length?(t.commands.deleteTable(),!0):!1},En=be.create({name:"table",addOptions(){return{HTMLAttributes:{},resizable:!1,handleWidth:5,cellMinWidth:25,View:xn,lastColumnResizable:!0,allowTableNodeSelection:!1}},content:"tableRow+",tableRole:"table",isolating:!0,group:"block",parseHTML(){return[{tag:"table"}]},renderHTML({node:t,HTMLAttributes:e}){const{colgroup:o,tableWidth:n,tableMinWidth:s}=Ln(t,this.options.cellMinWidth);return["table",se(this.options.HTMLAttributes,e,{style:n?`width: ${n}`:`minWidth: ${s}`}),o,["tbody",0]]},addCommands(){return{insertTable:({rows:t=3,cols:e=3,withHeaderRow:o=!0}={})=>({tr:n,dispatch:s,editor:r})=>{const i=Rn(r.schema,t,e,o);if(s){const a=n.selection.anchor+1;n.replaceSelectionWith(i).scrollIntoView().setSelection(j.near(n.doc.resolve(a)))}return!0},addColumnBefore:()=>({state:t,dispatch:e})=>dn(t,e),addColumnAfter:()=>({state:t,dispatch:e})=>un(t,e),deleteColumn:()=>({state:t,dispatch:e})=>fn(t,e),addRowBefore:()=>({state:t,dispatch:e})=>mn(t,e),addRowAfter:()=>({state:t,dispatch:e})=>gn(t,e),deleteRow:()=>({state:t,dispatch:e})=>wn(t,e),deleteTable:()=>({state:t,dispatch:e})=>kn(t,e),mergeCells:()=>({state:t,dispatch:e})=>Ke(t,e),splitCell:()=>({state:t,dispatch:e})=>qe(t,e),toggleHeaderColumn:()=>({state:t,dispatch:e})=>ne("column")(t,e),toggleHeaderRow:()=>({state:t,dispatch:e})=>ne("row")(t,e),toggleHeaderCell:()=>({state:t,dispatch:e})=>_n(t,e),mergeOrSplit:()=>({state:t,dispatch:e})=>Ke(t,e)?!0:qe(t,e),setCellAttribute:(t,e)=>({state:o,dispatch:n})=>vn(t,e)(o,n),goToNextCell:()=>({state:t,dispatch:e})=>Ge(1)(t,e),goToPreviousCell:()=>({state:t,dispatch:e})=>Ge(-1)(t,e),fixTables:()=>({state:t,dispatch:e})=>(e&&lt(t),!0),setCellSelection:t=>({tr:e,dispatch:o})=>{if(o){const n=S.create(e.doc,t.anchorCell,t.headCell);e.setSelection(n)}return!0}}},addKeyboardShortcuts(){return{Tab:()=>this.editor.commands.goToNextCell()?!0:this.editor.can().addRowAfter()?this.editor.chain().addRowAfter().goToNextCell().run():!1,"Shift-Tab":()=>this.editor.commands.goToPreviousCell(),Backspace:he,"Mod-Backspace":he,Delete:he,"Mod-Delete":he}},addProseMirrorPlugins(){return[...this.options.resizable&&this.editor.isEditable?[Qo({handleWidth:this.options.handleWidth,cellMinWidth:this.options.cellMinWidth,View:this.options.View,lastColumnResizable:this.options.lastColumnResizable})]:[],Mn({allowTableNodeSelection:this.options.allowTableNodeSelection})]},extendNodeSchema(t){const e={name:t.name,options:t.options,storage:t.storage};return{tableRole:oo(no(t,"tableRole",e))}}}),Nn=be.create({name:"tableCell",addOptions(){return{HTMLAttributes:{}}},content:"block+",addAttributes(){return{colspan:{default:1},rowspan:{default:1},colwidth:{default:null,parseHTML:t=>{const e=t.getAttribute("colwidth");return e?[parseInt(e,10)]:null}}}},tableRole:"cell",isolating:!0,parseHTML(){return[{tag:"td"}]},renderHTML({HTMLAttributes:t}){return["td",se(this.options.HTMLAttributes,t),0]}}),Hn=be.create({name:"tableHeader",addOptions(){return{HTMLAttributes:{}}},content:"block+",addAttributes(){return{colspan:{default:1},rowspan:{default:1},colwidth:{default:null,parseHTML:t=>{const e=t.getAttribute("colwidth");return e?[parseInt(e,10)]:null}}}},tableRole:"header_cell",isolating:!0,parseHTML(){return[{tag:"th"}]},renderHTML({HTMLAttributes:t}){return["th",se(this.options.HTMLAttributes,t),0]}}),Bn=be.create({name:"tableRow",addOptions(){return{HTMLAttributes:{}}},content:"(tableCell | tableHeader)*",tableRole:"row",parseHTML(){return[{tag:"tr"}]},renderHTML({HTMLAttributes:t}){return["tr",se(this.options.HTMLAttributes,t),0]}}),Dn=Mt("annotations",{state:()=>({annotations:[]}),actions:{setAnnotations(t){this.annotations.length=0,this.annotations.push(...t)}}}),Pn=`
<p>Iâ€™m running Annotation with Vue.js. ðŸŽ‰</p>
<div>
<h2>What is Lorem Ipsum?</h2>
<p><strong>Lorem Ipsum</strong> is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book. It has survived not only five centuries, but also the leap into electronic typesetting, remaining essentially unchanged. It was popularised in the 1960s with the release of Letraset sheets containing Lorem Ipsum passages, and more recently with desktop publishing software like Aldus PageMaker including versions of Lorem Ipsum.</p>
</div>

<img src="https://upload.wikimedia.org/wikipedia/commons/thumb/b/b6/Image_created_with_a_mobile_phone.png/220px-Image_created_with_a_mobile_phone.png" jsaction="VQAsE" class="sFlh5c pT0Scc iPVvYb" style="max-width: 220px; width: 220px; height: 165px; margin: 0px;" alt="Image - Wikipedia" jsname="kn3ccd" aria-hidden="false">

<div>
<h2>Where does it come from?</h2>
<p>Contrary to popular belief, Lorem Ipsum is not simply random text. It has roots in a piece of classical Latin literature from 45 BC, making it over 2000 years old. Richard McClintock, a Latin professor at Hampden-Sydney College in Virginia, looked up one of the more obscure Latin words, consectetur, from a Lorem Ipsum passage, and going through the cites of the word in classical literature, discovered the undoubtable source. Lorem Ipsum comes from sections 1.10.32 and 1.10.33 of "de Finibus Bonorum et Malorum" (The Extremes of Good and Evil) by Cicero, written in 45 BC. This book is a treatise on the theory of ethics, very popular during the Renaissance. The first line of Lorem Ipsum, "Lorem ipsum dolor sit amet..", comes from a line in section 1.10.32.</p><p>The standard chunk of Lorem Ipsum used since the 1500s is reproduced below for those interested. Sections 1.10.32 and 1.10.33 from "de Finibus Bonorum et Malorum" by Cicero are also reproduced in their exact original form, accompanied by English versions from the 1914 translation by H. Rackham.</p>
</div>

<p>Iâ€™m running Annotation with Vue.js. ðŸŽ‰</p>
<div>
<h2>What is Lorem Ipsum?</h2>
<p><strong>Lorem Ipsum</strong> is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book. It has survived not only five centuries, but also the leap into electronic typesetting, remaining essentially unchanged. It was popularised in the 1960s with the release of Letraset sheets containing Lorem Ipsum passages, and more recently with desktop publishing software like Aldus PageMaker including versions of Lorem Ipsum.</p>
</div>

<img src="https://upload.wikimedia.org/wikipedia/commons/thumb/b/b6/Image_created_with_a_mobile_phone.png/220px-Image_created_with_a_mobile_phone.png" jsaction="VQAsE" class="sFlh5c pT0Scc iPVvYb" style="max-width: 220px; width: 220px; height: 165px; margin: 0px;" alt="Image - Wikipedia" jsname="kn3ccd" aria-hidden="false">

<div>
<h2>Where does it come from?</h2>
<p>Contrary to popular belief, Lorem Ipsum is not simply random text. It has roots in a piece of classical Latin literature from 45 BC, making it over 2000 years old. Richard McClintock, a Latin professor at Hampden-Sydney College in Virginia, looked up one of the more obscure Latin words, consectetur, from a Lorem Ipsum passage, and going through the cites of the word in classical literature, discovered the undoubtable source. Lorem Ipsum comes from sections 1.10.32 and 1.10.33 of "de Finibus Bonorum et Malorum" (The Extremes of Good and Evil) by Cicero, written in 45 BC. This book is a treatise on the theory of ethics, very popular during the Renaissance. The first line of Lorem Ipsum, "Lorem ipsum dolor sit amet..", comes from a line in section 1.10.32.</p><p>The standard chunk of Lorem Ipsum used since the 1500s is reproduced below for those interested. Sections 1.10.32 and 1.10.33 from "de Finibus Bonorum et Malorum" by Cicero are also reproduced in their exact original form, accompanied by English versions from the 1914 translation by H. Rackham.</p>
</div>

<p>Iâ€™m running Annotation with Vue.js. ðŸŽ‰</p>
<div>
<h2>What is Lorem Ipsum?</h2>
<p><strong>Lorem Ipsum</strong> is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book. It has survived not only five centuries, but also the leap into electronic typesetting, remaining essentially unchanged. It was popularised in the 1960s with the release of Letraset sheets containing Lorem Ipsum passages, and more recently with desktop publishing software like Aldus PageMaker including versions of Lorem Ipsum.</p>
</div>

<img src="https://upload.wikimedia.org/wikipedia/commons/thumb/b/b6/Image_created_with_a_mobile_phone.png/220px-Image_created_with_a_mobile_phone.png" jsaction="VQAsE" class="sFlh5c pT0Scc iPVvYb" style="max-width: 220px; width: 220px; height: 165px; margin: 0px;" alt="Image - Wikipedia" jsname="kn3ccd" aria-hidden="false">

<div>
<h2>Where does it come from?</h2>
<p>Contrary to popular belief, Lorem Ipsum is not simply random text. It has roots in a piece of classical Latin literature from 45 BC, making it over 2000 years old. Richard McClintock, a Latin professor at Hampden-Sydney College in Virginia, looked up one of the more obscure Latin words, consectetur, from a Lorem Ipsum passage, and going through the cites of the word in classical literature, discovered the undoubtable source. Lorem Ipsum comes from sections 1.10.32 and 1.10.33 of "de Finibus Bonorum et Malorum" (The Extremes of Good and Evil) by Cicero, written in 45 BC. This book is a treatise on the theory of ethics, very popular during the Renaissance. The first line of Lorem Ipsum, "Lorem ipsum dolor sit amet..", comes from a line in section 1.10.32.</p><p>The standard chunk of Lorem Ipsum used since the 1500s is reproduced below for those interested. Sections 1.10.32 and 1.10.33 from "de Finibus Bonorum et Malorum" by Cicero are also reproduced in their exact original form, accompanied by English versions from the 1914 translation by H. Rackham.</p>
</div>

<div>
<h2>Where does it come from?</h2>
<p>Contrary to popular belief, Lorem Ipsum is not simply random text. It has roots in a piece of classical Latin literature from 45 BC, making it over 2000 years old. Richard McClintock, a Latin professor at Hampden-Sydney College in Virginia, looked up one of the more obscure Latin words, consectetur, from a Lorem Ipsum passage, and going through the cites of the word in classical literature, discovered the undoubtable source. Lorem Ipsum comes from sections 1.10.32 and 1.10.33 of "de Finibus Bonorum et Malorum" (The Extremes of Good and Evil) by Cicero, written in 45 BC. This book is a treatise on the theory of ethics, very popular during the Renaissance. The first line of Lorem Ipsum, "Lorem ipsum dolor sit amet..", comes from a line in section 1.10.32.</p><p>The standard chunk of Lorem Ipsum used since the 1500s is reproduced below for those interested. Sections 1.10.32 and 1.10.33 from "de Finibus Bonorum et Malorum" by Cicero are also reproduced in their exact original form, accompanied by English versions from the 1914 translation by H. Rackham.</p>
</div>

<p>Iâ€™m running Annotation with Vue.js. ðŸŽ‰</p>
<div>
<h2>What is Lorem Ipsum?</h2>
<p><strong>Lorem Ipsum</strong> is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book. It has survived not only five centuries, but also the leap into electronic typesetting, remaining essentially unchanged. It was popularised in the 1960s with the release of Letraset sheets containing Lorem Ipsum passages, and more recently with desktop publishing software like Aldus PageMaker including versions of Lorem Ipsum.</p>
</div>

<img src="https://upload.wikimedia.org/wikipedia/commons/thumb/b/b6/Image_created_with_a_mobile_phone.png/220px-Image_created_with_a_mobile_phone.png" jsaction="VQAsE" class="sFlh5c pT0Scc iPVvYb" style="max-width: 220px; width: 220px; height: 165px; margin: 0px;" alt="Image - Wikipedia" jsname="kn3ccd" aria-hidden="false">

<div>
<h2>Where does it come from?</h2>
<p>Contrary to popular belief, Lorem Ipsum is not simply random text. It has roots in a piece of classical Latin literature from 45 BC, making it over 2000 years old. Richard McClintock, a Latin professor at Hampden-Sydney College in Virginia, looked up one of the more obscure Latin words, consectetur, from a Lorem Ipsum passage, and going through the cites of the word in classical literature, discovered the undoubtable source. Lorem Ipsum comes from sections 1.10.32 and 1.10.33 of "de Finibus Bonorum et Malorum" (The Extremes of Good and Evil) by Cicero, written in 45 BC. This book is a treatise on the theory of ethics, very popular during the Renaissance. The first line of Lorem Ipsum, "Lorem ipsum dolor sit amet..", comes from a line in section 1.10.32.</p><p>The standard chunk of Lorem Ipsum used since the 1500s is reproduced below for those interested. Sections 1.10.32 and 1.10.33 from "de Finibus Bonorum et Malorum" by Cicero are also reproduced in their exact original form, accompanied by English versions from the 1914 translation by H. Rackham.</p>
</div>

`,Z=t=>(Lt("data-v-3ef6eaea"),t=t(),Tt(),t),$n={class:"card my-1",style:{width:"18rem"}},zn={class:"card-body"},jn={class:"card-title"},On={class:"card-subtitle mb-2 text-muted"},Wn={class:"card-text"},Fn=Z(()=>m("br",null,null,-1)),Vn=Z(()=>m("br",null,null,-1)),Kn=Z(()=>m("br",null,null,-1)),qn=Z(()=>m("br",null,null,-1)),Un=Z(()=>m("br",null,null,-1)),Gn=Z(()=>m("hr",null,null,-1)),Xn={__name:"AnnotationCard",props:{annotation:Object},emits:["update","remove"],setup(t,{emit:e}){const o=t,n=e,{id:s,from:r,to:i,data:a}=o.annotation,l=()=>{n("update")},c=()=>{n("remove")};return(d,u)=>(P(),X("div",null,[m("div",$n,[m("div",zn,[m("h5",jn,$(v(a).name),1),m("h6",On,"ID: "+$(v(s)),1),m("p",Wn,[J(" From: "+$(v(r))+" To: "+$(v(i)),1),Fn,J(" Magic Number: "+$(v(a).magicNumber),1),Vn,J(" Annotation: "+$(v(a).annotate),1),Kn,J(" Author: "+$(v(a).author)+" ",1),qn,J(" Color: "+$(v(a).color)+" ",1),Un]),Gn,m("div",{class:"d-grid gap-2 d-md-block"},[m("button",{class:"btn btn-danger",onClick:c},"Remove"),m("button",{class:"btn btn-secondary",onClick:l},"Increment")])])])]))}},Yn=xt(Xn,[["__scopeId","data-v-3ef6eaea"]]),Jn={class:"container"},Qn=m("h3",null," Annotation Editor ",-1),Zn=m("hr",null,null,-1),es={class:"row"},ts={class:"col-md-4 border-end"},os={class:"row row-cols-4"},ns={class:"col-6 col-sm-4"},ss=["checked"],rs=m("label",{class:"form-check-label",for:"flexSwitchCheckDefault"},"Editable",-1),is={class:"col-6 col-sm-8 text-end"},ls=["disabled"],as=m("hr",null,null,-1),cs=["data-bs-whatever"],ds={class:"modal-dialog"},us={class:"modal-content"},hs=m("div",{class:"modal-header"},[m("h1",{class:"modal-title fs-5",id:"exampleModalLabel"},"New Annotation"),m("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),fs={class:"modal-body"},ps=m("div",{class:"mb-3"},[m("label",{for:"author-name",class:"col-form-label"},"Author:"),m("input",{type:"text",class:"form-control",id:"author-name",disabled:""})],-1),ms={class:"mb-3"},gs={class:"p-2 mb-3 col-5 border rounded-2"},bs={key:0},ws=m("label",{for:"color-name",class:"p-1 col-form-label border-start me-3"},"Color picker",-1),ys=m("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Close",-1),Cs={id:"annotationList"},vs={key:0},As={key:1},_s=m("h4",{class:"bi bi-arrow-return-right me-2"},"Annotation List",-1),Ss={class:"col-md-8"},ks=m("hr",null,null,-1),Is={__name:"AnnotateView",props:{lessonId:{type:String,default:()=>!1}},setup(t){const e=Rt(),o=e.username,n=t,s=()=>{if(n.lessonId)return console.log("TipTap Is Component",n.lessonId),!0},r=It();Et();const i=L(r.name);L(r.params.type);const a=L(r.params.id),l=L(""),c=()=>{if(i.value==="annotateLesson")return console.log("Annotate Lesson"),!0},d=async y=>await co(y),u=L({name:"Test",magicNumber:1,color:""}),h=L(!1),f=L(!1),p=L(!1),g=L(!0),w=L(0),A=new Ze.AnnotationMagic,O=Dn(),T=O.annotations,W=L(""),B=L({}),U=L({}),F=L({}),G=L("#00000000"),ht=y=>{let b=y.state;if(b===void 0||b.selection===void 0||b.selection.empty)return!1;const{from:M,to:C}=b.selection;return M!==C},ft=(y,b,M,C,D,ee)=>ht(y),_=ro({content:Pn,extensions:[io,A.configure({onAnnotationListChange:y=>{pt(y)},styles:{leftFragment:"annotation-base fragment-left",rightFragment:"annotation-base fragment-right",middleFragment:"annotation-base fragment-middle",normal:"annotation-base annotation-normal"}}),xo.configure({multicolor:!0}),En.configure({resizable:!0}),Bn,Hn,Nn],onUpdate:()=>{console.log("Editor Content Updated"),w.value+=1}}),pt=y=>{console.log("Adding Attn items to Pinia Store"),console.log(y),O.setAnnotations(y)},mt=y=>{let b=Wt({...y.value});console.log("addAnnotate val:",b),_.value&&_.value.chain().focus().addAnnotation(b).run()},gt=y=>{y.forEach(b=>{console.log("Restoring",b);let M=b.data,C={from:b.from,to:b.to},D={name:M.name,magicNumber:M.magicNumber,annotate:M.annotate,author:M.author,color:M.color};console.log("Reconstructing",C,D),_.value&&(console.log("Restore bytch"),_.value.chain().setTextSelection(C).focus().addAnnotation(D).run())})},bt=async()=>{console.log("SAVE All Annotations",O.annotations);const y=e.token,b=Be(y)._id;console.log("User id is: ",b);const M={userId:b,userAnnotations:O.annotations};try{(await ho(a,M)).ok&&console.log("Annotaton Saved")}catch(C){console.log(C)}},wt=async()=>{console.log("GETTING All Annotations",O.annotations);const y=e.token,b=Be(y)._id;console.log("User id is: ",b);try{let C=(await uo(a)).filter(kt=>kt.userId===b);const[D]=C;let ee=D.userAnnotations;console.log("Restoring user attnDB",ee),gt(ee)}catch(M){console.log(M)}},yt=y=>{_.value&&_.value.chain().focus().deleteAnnotation(y).run()},Ct=y=>{if(_.value){let b={...y.data,magicNumber:y.data.magicNumber+1};_.value.chain().focus().updateAnnotation(y.id,b).run()}},vt=()=>{console.log(T),h.value=!h.value};Nt(f,y=>{_.value.setEditable(y)});const At=async()=>{u.value.annotate=W.value,u.value.author=o,u.value.color=G.value,console.log("Each AD",u.value),mt(u),await bt(),delete u.value.annotate,delete u.value.author,u.value.magicNumber++,W.value="",p.value=!1},_t=()=>{U.value.click()},St=()=>{const y=document.getElementById("annotateModal");y.addEventListener("show.bs.modal",b=>{const C=b.relatedTarget.getAttribute("data-bs-whatever")||o,D=y.querySelector(".modal-title"),ee=y.querySelector(".modal-body input");D.textContent=`New Annotation by ${C}`,ee.value=C}),y.addEventListener("shown.bs.modal",function(b){F.value.focus()}),y.addEventListener("hide.bs.modal",function(b){console.log("Modal Closed"),p.value=!1}),y.addEventListener("hidden.bs.modal",function(b){p.value=!1})};return Ht(async()=>{s()&&(a.value=n.lessonId)}),Bt(async()=>{St(),_.value.setEditable(f.value),c()&&(_.value.commands.setContent("This is Lesson"),l.value=await d(a),_.value.commands.setContent(l.value)),s()&&(_.value.commands.setContent("#Loading"),a.value=n.lessonId,l.value=await d(a),_.value.commands.setContent(l.value),await wt())}),Dt(()=>{_.value.destroy()}),(y,b)=>{const M=Pt("color-picker");return P(),X("div",Jn,[Qn,Zn,m("div",es,[m("div",ts,[m("div",os,[m("div",ns,[m("div",{class:"form-check form-switch mt-2",onChange:b[0]||(b[0]=()=>f.value=!f.value)},[m("input",{class:"form-check-input",checked:f.value,type:"checkbox",id:"flexSwitchCheckDefault"},null,8,ss),rs],32)]),m("div",is,[m("input",{type:"checkbox",class:"btn-check",id:"btn-check",autocomplete:"off",disabled:v(T).length===0},null,8,ls),m("label",{class:"btn btn-primary",for:"btn-check",onClick:b[1]||(b[1]=C=>vt())},[re(m("i",{class:ie(["me-1",h.value?"bi bi-arrows-angle-expand":"bi bi-arrows-angle-contract"]),style:{"font-size":"1.2rem"}},null,2),[[ve,v(T).length!==0]]),J(" Toggle Annotation ")])])]),as,re(m("button",{ref_key:"myAnnotateModalButton",ref:U,onClick:b[2]||(b[2]=()=>{p.value=!0}),type:"button",class:"btn btn-outline-primary my-2 me-1 w-40","data-bs-toggle":"modal","data-bs-target":"#annotateModal","data-bs-whatever":v(o)},"Add Annotation",8,cs),[[ve,!g.value]]),m("div",{ref_key:"myAnnotateModal",ref:B,class:"modal fade my-modal",id:"annotateModal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},[m("div",ds,[m("div",us,[hs,m("div",fs,[m("form",null,[ps,m("div",ms,[m("label",{ref_key:"commentModal",ref:F,for:"comment-text",class:"col-form-label"},"Comment:",512),re(m("textarea",{class:"form-control",id:"comment-text","onUpdate:modelValue":b[3]||(b[3]=C=>W.value=C)},null,512),[[$t,W.value]])]),m("div",gs,[p.value?(P(),X("span",bs,[Ne(M,{pureColor:G.value,"onUpdate:pureColor":b[4]||(b[4]=C=>G.value=C),"blur-close":!0,format:"hex8"},null,8,["pureColor"])])):le("",!0),ws])])]),m("div",{class:"modal-footer"},[ys,m("button",{type:"button",class:"btn btn-primary",onClick:At,"data-bs-dismiss":"modal"},"Save Annotation")])])])],512),m("div",Cs,[v(_)&&(!h.value||v(T).length<1)?(P(),X("div",vs,[m("h4",null,"Annotation List - Count: "+$(v(T).length),1)])):le("",!0),v(_)&&h.value&&v(T).length>0?(P(),X("div",As,[_s,(P(!0),X(zt,null,jt(v(T),C=>(P(),X("div",{key:C.id+w.value,class:"overflow-auto",style:{"overflow-wrap":"normal"}},[(P(),He(Yn,{annotation:C,key:C.id+(C.data?C.data.magicNumber:0),onUpdate:D=>Ct(C),onRemove:D=>yt(C.id)},null,8,["annotation","onUpdate","onRemove"]))]))),128))])):le("",!0)])]),m("div",Ss,[m("div",null,[v(_)?re((P(),He(v(lo),{key:0,editor:v(_),"tippy-options":{duration:100},"should-show":ft},{default:Ot(()=>[m("button",{onClick:b[5]||(b[5]=C=>v(_).chain().focus().toggleBold().run()),class:ie({"is-active":v(_).isActive("bold")})}," bold ",2),m("button",{onClick:b[6]||(b[6]=C=>v(_).chain().focus().toggleItalic().run()),class:ie({"is-active":v(_).isActive("italic")})}," italic ",2),m("button",{onClick:b[7]||(b[7]=C=>v(_).chain().focus().toggleStrike().run()),class:ie({"is-active":v(_).isActive("strike")})}," strike ",2),m("button",{onClick:_t}," Annotate ")]),_:1},8,["editor"])),[[ve,!p.value]]):le("",!0),Ne(v(ao),{editor:v(_)},null,8,["editor"])])])]),ks])}}};export{Is as default};
