import{_ as et,k as rt,e as nt,r as y,n as it,D as st,f as ot,M as at,o as S,c as L,a as b,q as M,h as lt,l as P,A as ct,p as dt,j as ut}from"./index-B-03LEUy.js";import{v as ht,w as E,x as N,M as x,y as J,F as D,o as g,P as pt,a as mt,z as gt,C as ft,u as kt,s as wt,t as q}from"./index-DSMuaTct.js";import{M as A,t as bt}from"./index-E_dV9pc7.js";import{k as xt,h as Mt}from"./CRUD-xJdNO43X.js";import"./index-C_YRfJz0.js";const Tt=new ht({nodes:{doc:{content:"block+"},paragraph:{content:"inline*",group:"block",parseDOM:[{tag:"p"}],toDOM(){return["p",0]}},blockquote:{content:"block+",group:"block",parseDOM:[{tag:"blockquote"}],toDOM(){return["blockquote",0]}},horizontal_rule:{group:"block",parseDOM:[{tag:"hr"}],toDOM(){return["div",["hr"]]}},heading:{attrs:{level:{default:1}},content:"(text | image)*",group:"block",defining:!0,parseDOM:[{tag:"h1",attrs:{level:1}},{tag:"h2",attrs:{level:2}},{tag:"h3",attrs:{level:3}},{tag:"h4",attrs:{level:4}},{tag:"h5",attrs:{level:5}},{tag:"h6",attrs:{level:6}}],toDOM(e){return["h"+e.attrs.level,0]}},code_block:{content:"text*",group:"block",code:!0,defining:!0,marks:"",attrs:{params:{default:""}},parseDOM:[{tag:"pre",preserveWhitespace:"full",getAttrs:e=>({params:e.getAttribute("data-params")||""})}],toDOM(e){return["pre",e.attrs.params?{"data-params":e.attrs.params}:{},["code",0]]}},ordered_list:{content:"list_item+",group:"block",attrs:{order:{default:1},tight:{default:!1}},parseDOM:[{tag:"ol",getAttrs(e){return{order:e.hasAttribute("start")?+e.getAttribute("start"):1,tight:e.hasAttribute("data-tight")}}}],toDOM(e){return["ol",{start:e.attrs.order==1?null:e.attrs.order,"data-tight":e.attrs.tight?"true":null},0]}},bullet_list:{content:"list_item+",group:"block",attrs:{tight:{default:!1}},parseDOM:[{tag:"ul",getAttrs:e=>({tight:e.hasAttribute("data-tight")})}],toDOM(e){return["ul",{"data-tight":e.attrs.tight?"true":null},0]}},list_item:{content:"block+",defining:!0,parseDOM:[{tag:"li"}],toDOM(){return["li",0]}},text:{group:"inline"},image:{inline:!0,attrs:{src:{},alt:{default:null},title:{default:null}},group:"inline",draggable:!0,parseDOM:[{tag:"img[src]",getAttrs(e){return{src:e.getAttribute("src"),title:e.getAttribute("title"),alt:e.getAttribute("alt")}}}],toDOM(e){return["img",e.attrs]}},hard_break:{inline:!0,group:"inline",selectable:!1,parseDOM:[{tag:"br"}],toDOM(){return["br"]}}},marks:{em:{parseDOM:[{tag:"i"},{tag:"em"},{style:"font-style=italic"},{style:"font-style=normal",clearMark:e=>e.type.name=="em"}],toDOM(){return["em"]}},strong:{parseDOM:[{tag:"strong"},{tag:"b",getAttrs:e=>e.style.fontWeight!="normal"&&null},{style:"font-weight=400",clearMark:e=>e.type.name=="strong"},{style:"font-weight",getAttrs:e=>/^(bold(er)?|[5-9]\d{2,})$/.test(e)&&null}],toDOM(){return["strong"]}},link:{attrs:{href:{},title:{default:null}},inclusive:!1,parseDOM:[{tag:"a[href]",getAttrs(e){return{href:e.getAttribute("href"),title:e.getAttribute("title")}}}],toDOM(e){return["a",e.attrs]}},code:{parseDOM:[{tag:"code"}],toDOM(){return["code"]}}}});function vt(e,t){if(e.isText&&t.isText&&E.sameSet(e.marks,t.marks))return e.withText(e.text+t.text)}class yt{constructor(t,r){this.schema=t,this.tokenHandlers=r,this.stack=[{type:t.topNodeType,attrs:null,content:[],marks:E.none}]}top(){return this.stack[this.stack.length-1]}push(t){this.stack.length&&this.top().content.push(t)}addText(t){if(!t)return;let r=this.top(),n=r.content,i=n[n.length-1],o=this.schema.text(t,r.marks),s;i&&(s=vt(i,o))?n[n.length-1]=s:n.push(o)}openMark(t){let r=this.top();r.marks=t.addToSet(r.marks)}closeMark(t){let r=this.top();r.marks=t.removeFromSet(r.marks)}parseTokens(t){for(let r=0;r<t.length;r++){let n=t[r],i=this.tokenHandlers[n.type];if(!i)throw new Error("Token type `"+n.type+"` not supported by Markdown parser");i(this,n,t,r)}}addNode(t,r,n){let i=this.top(),o=t.createAndFill(r,n,i?i.marks:[]);return o?(this.push(o),o):null}openNode(t,r){this.stack.push({type:t,attrs:r,content:[],marks:E.none})}closeNode(){let t=this.stack.pop();return this.addNode(t.type,t.attrs,t.content)}}function T(e,t,r,n){return e.getAttrs?e.getAttrs(t,r,n):e.attrs instanceof Function?e.attrs(t):e.attrs}function O(e,t){return e.noCloseToken||t=="code_inline"||t=="code_block"||t=="fence"}function j(e){return e[e.length-1]==`
`?e.slice(0,e.length-1):e}function $(){}function St(e,t){let r=Object.create(null);for(let n in t){let i=t[n];if(i.block){let o=e.nodeType(i.block);O(i,n)?r[n]=(s,c,l,a)=>{s.openNode(o,T(i,c,l,a)),s.addText(j(c.content)),s.closeNode()}:(r[n+"_open"]=(s,c,l,a)=>s.openNode(o,T(i,c,l,a)),r[n+"_close"]=s=>s.closeNode())}else if(i.node){let o=e.nodeType(i.node);r[n]=(s,c,l,a)=>s.addNode(o,T(i,c,l,a))}else if(i.mark){let o=e.marks[i.mark];O(i,n)?r[n]=(s,c,l,a)=>{s.openMark(o.create(T(i,c,l,a))),s.addText(j(c.content)),s.closeMark(o)}:(r[n+"_open"]=(s,c,l,a)=>s.openMark(o.create(T(i,c,l,a))),r[n+"_close"]=s=>s.closeMark(o))}else if(i.ignore)O(i,n)?r[n]=$:(r[n+"_open"]=$,r[n+"_close"]=$);else throw new RangeError("Unrecognized parsing spec "+JSON.stringify(i))}return r.text=(n,i)=>n.addText(i.content),r.inline=(n,i)=>n.parseTokens(i.children),r.softbreak=r.softbreak||(n=>n.addText(" ")),r}let Ct=class{constructor(t,r,n){this.schema=t,this.tokenizer=r,this.tokens=n,this.tokenHandlers=St(t,n)}parse(t,r={}){let n=new yt(this.schema,this.tokenHandlers),i;n.parseTokens(this.tokenizer.parse(t,r));do i=n.closeNode();while(n.stack.length);return i||this.schema.topNodeType.createAndFill()}};function R(e,t){for(;++t<e.length;)if(e[t].type!="list_item_open")return e[t].hidden;return!1}new Ct(Tt,A("commonmark",{html:!1}),{blockquote:{block:"blockquote"},paragraph:{block:"paragraph"},list_item:{block:"list_item"},bullet_list:{block:"bullet_list",getAttrs:(e,t,r)=>({tight:R(t,r)})},ordered_list:{block:"ordered_list",getAttrs:(e,t,r)=>({order:+e.attrGet("start")||1,tight:R(t,r)})},heading:{block:"heading",getAttrs:e=>({level:+e.tag.slice(1)})},code_block:{block:"code_block",noCloseToken:!0},fence:{block:"code_block",getAttrs:e=>({params:e.info||""}),noCloseToken:!0},hr:{node:"horizontal_rule"},image:{node:"image",getAttrs:e=>({src:e.attrGet("src"),title:e.attrGet("title")||null,alt:e.children[0]&&e.children[0].content||null})},hardbreak:{node:"hard_break"},em:{mark:"em"},strong:{mark:"strong"},link:{mark:"link",getAttrs:e=>({href:e.attrGet("href"),title:e.attrGet("title")||null})},code_inline:{mark:"code",noCloseToken:!0}});let _t=class{constructor(t,r,n={}){this.nodes=t,this.marks=r,this.options=n}serialize(t,r={}){r=Object.assign({},this.options,r);let n=new U(this.nodes,this.marks,r);return n.renderContent(t),n.out}};const k=new _t({blockquote(e,t){e.wrapBlock("> ",null,t,()=>e.renderContent(t))},code_block(e,t){const r=t.textContent.match(/`{3,}/gm),n=r?r.sort().slice(-1)[0]+"`":"```";e.write(n+(t.attrs.params||"")+`
`),e.text(t.textContent,!1),e.write(`
`),e.write(n),e.closeBlock(t)},heading(e,t){e.write(e.repeat("#",t.attrs.level)+" "),e.renderInline(t,!1),e.closeBlock(t)},horizontal_rule(e,t){e.write(t.attrs.markup||"---"),e.closeBlock(t)},bullet_list(e,t){e.renderList(t,"  ",()=>(t.attrs.bullet||"*")+" ")},ordered_list(e,t){let r=t.attrs.order||1,n=String(r+t.childCount-1).length,i=e.repeat(" ",n+2);e.renderList(t,i,o=>{let s=String(r+o);return e.repeat(" ",n-s.length)+s+". "})},list_item(e,t){e.renderContent(t)},paragraph(e,t){e.renderInline(t),e.closeBlock(t)},image(e,t){e.write("!["+e.esc(t.attrs.alt||"")+"]("+t.attrs.src.replace(/[\(\)]/g,"\\$&")+(t.attrs.title?' "'+t.attrs.title.replace(/"/g,'\\"')+'"':"")+")")},hard_break(e,t,r,n){for(let i=n+1;i<r.childCount;i++)if(r.child(i).type!=t.type){e.write(`\\
`);return}},text(e,t){e.text(t.text,!e.inAutolink)}},{em:{open:"*",close:"*",mixable:!0,expelEnclosingWhitespace:!0},strong:{open:"**",close:"**",mixable:!0,expelEnclosingWhitespace:!0},link:{open(e,t,r,n){return e.inAutolink=zt(t,r,n),e.inAutolink?"<":"["},close(e,t,r,n){let{inAutolink:i}=e;return e.inAutolink=void 0,i?">":"]("+t.attrs.href.replace(/[\(\)"]/g,"\\$&")+(t.attrs.title?` "${t.attrs.title.replace(/"/g,'\\"')}"`:"")+")"},mixable:!0},code:{open(e,t,r,n){return F(r.child(n),-1)},close(e,t,r,n){return F(r.child(n-1),1)},escape:!1}});function F(e,t){let r=/`+/g,n,i=0;if(e.isText)for(;n=r.exec(e.text);)i=Math.max(i,n[0].length);let o=i>0&&t>0?" `":"`";for(let s=0;s<i;s++)o+="`";return i>0&&t<0&&(o+=" "),o}function zt(e,t,r){if(e.attrs.title||!/^\w+:/.test(e.attrs.href))return!1;let n=t.child(r);return!n.isText||n.text!=e.attrs.href||n.marks[n.marks.length-1]!=e?!1:r==t.childCount-1||!e.isInSet(t.child(r+1).marks)}let U=class{constructor(t,r,n){this.nodes=t,this.marks=r,this.options=n,this.delim="",this.out="",this.closed=null,this.inAutolink=void 0,this.atBlockStart=!1,this.inTightList=!1,typeof this.options.tightLists>"u"&&(this.options.tightLists=!1),typeof this.options.hardBreakNodeName>"u"&&(this.options.hardBreakNodeName="hard_break")}flushClose(t=2){if(this.closed){if(this.atBlank()||(this.out+=`
`),t>1){let r=this.delim,n=/\s+$/.exec(r);n&&(r=r.slice(0,r.length-n[0].length));for(let i=1;i<t;i++)this.out+=r+`
`}this.closed=null}}wrapBlock(t,r,n,i){let o=this.delim;this.write(r??t),this.delim+=t,i(),this.delim=o,this.closeBlock(n)}atBlank(){return/(^|\n)$/.test(this.out)}ensureNewLine(){this.atBlank()||(this.out+=`
`)}write(t){this.flushClose(),this.delim&&this.atBlank()&&(this.out+=this.delim),t&&(this.out+=t)}closeBlock(t){this.closed=t}text(t,r=!0){let n=t.split(`
`);for(let i=0;i<n.length;i++)this.write(),!r&&n[i][0]=="["&&/(^|[^\\])\!$/.test(this.out)&&(this.out=this.out.slice(0,this.out.length-1)+"\\!"),this.out+=r?this.esc(n[i],this.atBlockStart):n[i],i!=n.length-1&&(this.out+=`
`)}render(t,r,n){if(!this.nodes[t.type.name])throw new Error("Token type `"+t.type.name+"` not supported by Markdown renderer");this.nodes[t.type.name](this,t,r,n)}renderContent(t){t.forEach((r,n,i)=>this.render(r,t,i))}renderInline(t,r=!0){this.atBlockStart=r;let n=[],i="",o=(s,c,l)=>{let a=s?s.marks:[];s&&s.type.name===this.options.hardBreakNodeName&&(a=a.filter(d=>{if(l+1==t.childCount)return!1;let u=t.child(l+1);return d.isInSet(u.marks)&&(!u.isText||/\S/.test(u.text))}));let h=i;if(i="",s&&s.isText&&a.some(d=>{let u=this.marks[d.type.name];return u&&u.expelEnclosingWhitespace&&!d.isInSet(n)})){let[d,u,m]=/^(\s*)(.*)$/m.exec(s.text);u&&(h+=u,s=m?s.withText(m):null,s||(a=n))}if(s&&s.isText&&a.some(d=>{let u=this.marks[d.type.name];return u&&u.expelEnclosingWhitespace&&(l==t.childCount-1||!d.isInSet(t.child(l+1).marks))})){let[d,u,m]=/^(.*?)(\s*)$/m.exec(s.text);m&&(i=m,s=u?s.withText(u):null,s||(a=n))}let w=a.length?a[a.length-1]:null,v=w&&this.marks[w.type.name].escape===!1,p=a.length-(v?1:0);t:for(let d=0;d<p;d++){let u=a[d];if(!this.marks[u.type.name].mixable)break;for(let m=0;m<n.length;m++){let I=n[m];if(!this.marks[I.type.name].mixable)break;if(u.eq(I)){d>m?a=a.slice(0,m).concat(u).concat(a.slice(m,d)).concat(a.slice(d+1,p)):m>d&&(a=a.slice(0,d).concat(a.slice(d+1,m)).concat(u).concat(a.slice(m,p)));continue t}}}let f=0;for(;f<Math.min(n.length,p)&&a[f].eq(n[f]);)++f;for(;f<n.length;)this.text(this.markString(n.pop(),!1,t,l),!1);if(h&&this.text(h),s){for(;n.length<p;){let d=a[n.length];n.push(d),this.text(this.markString(d,!0,t,l),!1),this.atBlockStart=!1}v&&s.isText?this.text(this.markString(w,!0,t,l)+s.text+this.markString(w,!1,t,l+1),!1):this.render(s,t,l),this.atBlockStart=!1}s!=null&&s.isText&&s.nodeSize>0&&(this.atBlockStart=!1)};t.forEach(o),o(null,0,t.childCount),this.atBlockStart=!1}renderList(t,r,n){this.closed&&this.closed.type==t.type?this.flushClose(3):this.inTightList&&this.flushClose(1);let i=typeof t.attrs.tight<"u"?t.attrs.tight:this.options.tightLists,o=this.inTightList;this.inTightList=i,t.forEach((s,c,l)=>{l&&i&&this.flushClose(1),this.wrapBlock(r,n(l),t,()=>this.render(s,t,l))}),this.inTightList=o}esc(t,r=!1){return t=t.replace(/[`*\\~\[\]_]/g,(n,i)=>n=="_"&&i>0&&i+1<t.length&&t[i-1].match(/\w/)&&t[i+1].match(/\w/)?n:"\\"+n),r&&(t=t.replace(/^(\+[ ]|[\-*>])/,"\\$&").replace(/^(\s*)(#{1,6})(\s|$)/,"$1\\$2$3").replace(/^(\s*\d+)\.\s/,"$1\\. ")),this.options.escapeExtraCharacters&&(t=t.replace(this.options.escapeExtraCharacters,"\\$&")),t}quote(t){let r=t.indexOf('"')==-1?'""':t.indexOf("'")==-1?"''":"()";return r[0]+t+r[1]}repeat(t,r){let n="";for(let i=0;i<r;i++)n+=t;return n}markString(t,r,n,i){let o=this.marks[t.type.name],s=r?o.open:o.close;return typeof s=="string"?s:s(this,t,n,i)}getEnclosingWhitespace(t){return{leading:(t.match(/^(\s+)/)||[void 0])[0],trailing:(t.match(/(\s+)$/)||[void 0])[0]}}};var Lt=Object.defineProperty,Ot=(e,t,r)=>t in e?Lt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,C=(e,t,r)=>(Ot(e,typeof t!="symbol"?t+"":t,r),r);const $t=N.create({name:"markdownTightLists",addOptions:()=>({tight:!0,tightClass:"tight",listTypes:["bulletList","orderedList"]}),addGlobalAttributes(){return[{types:this.options.listTypes,attributes:{tight:{default:this.options.tight,parseHTML:e=>e.getAttribute("data-tight")==="true"||!e.querySelector("p"),renderHTML:e=>({class:e.tight?this.options.tightClass:null,"data-tight":e.tight?"true":null})}}}]},addCommands(){var e=this;return{toggleTight:function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return r=>{let{editor:n,commands:i}=r;function o(s){if(!n.isActive(s))return!1;const c=n.getAttributes(s);return i.updateAttributes(s,{tight:t??!(c!=null&&c.tight)})}return e.options.listTypes.some(s=>o(s))}}}}}),W=A();function K(e,t){return W.inline.State.prototype.scanDelims.call({src:e,posMax:e.length}),new W.inline.State(e,null,null,[]).scanDelims(t,!0)}function X(e,t,r,n){let i=e.substring(0,r)+e.substring(r+t.length);return i=i.substring(0,r+n)+t+i.substring(r+n),i}function Bt(e,t,r,n){let i=r,o=e;for(;i<n&&!K(o,i).can_open;)o=X(o,t,i,1),i++;return{text:o,from:i,to:n}}function Et(e,t,r,n){let i=n,o=e;for(;i>r&&!K(o,i).can_close;)o=X(o,t,i,-1),i--;return{text:o,from:r,to:i}}function Dt(e,t,r,n){let i={text:e,from:r,to:n};return i=Bt(i.text,t,i.from,i.to),i=Et(i.text,t,i.from,i.to),i.to-i.from<t.length+1&&(i.text=i.text.substring(0,i.from)+i.text.substring(i.to+t.length)),i.text}class Nt extends U{constructor(t,r,n){super(t,r,n??{}),C(this,"inTable",!1),this.inlines=[]}render(t,r,n){super.render(t,r,n);const i=this.inlines[this.inlines.length-1];if(i!=null&&i.start&&i!==null&&i!==void 0&&i.end){const{delimiter:o,start:s,end:c}=this.normalizeInline(i);this.out=Dt(this.out,o,s,c),this.inlines.pop()}}markString(t,r,n,i){const o=this.marks[t.type.name];if(o.expelEnclosingWhitespace)if(r)this.inlines.push({start:this.out.length,delimiter:o.open});else{const s=this.inlines.pop();this.inlines.push({...s,end:this.out.length})}return super.markString(t,r,n,i)}normalizeInline(t){let{start:r,end:n}=t;for(;this.out.charAt(r).match(/\s/);)r++;return{...t,start:r}}}const Q=x.create({name:"markdownHTMLMark",addStorage(){return{markdown:{serialize:{open(e,t){var r,n;return this.editor.storage.markdown.options.html?(r=(n=G(t))===null||n===void 0?void 0:n[0])!==null&&r!==void 0?r:"":(console.warn(`Tiptap Markdown: "${t.type.name}" mark is only available in html mode`),"")},close(e,t){var r,n;return this.editor.storage.markdown.options.html&&(r=(n=G(t))===null||n===void 0?void 0:n[1])!==null&&r!==void 0?r:""}},parse:{}}}}});function G(e){const t=e.type.schema,r=t.text(" ",[e]),i=J(D.from(r),t).match(/^(<.*?>) (<\/.*?>)$/);return i?[i[1],i[2]]:null}function H(e){const t=`<body>${e}</body>`;return new window.DOMParser().parseFromString(t,"text/html").body}function At(e){return e==null?void 0:e.replace(/</g,"&lt;").replace(/>/g,"&gt;")}function Ht(e){const t=e.parentElement,r=t.cloneNode();for(;t.firstChild&&t.firstChild!==e;)r.appendChild(t.firstChild);r.childNodes.length>0&&t.parentElement.insertBefore(r,t),t.parentElement.insertBefore(e,t),t.childNodes.length===0&&t.remove()}function It(e){const t=e.parentNode;for(;e.firstChild;)t.insertBefore(e.firstChild,e);t.removeChild(e)}const z=g.create({name:"markdownHTMLNode",addStorage(){return{markdown:{serialize(e,t,r){this.editor.storage.markdown.options.html?e.write(Pt(t,r)):(console.warn(`Tiptap Markdown: "${t.type.name}" node is only available in html mode`),e.write(`[${t.type.name}]`)),t.isBlock&&e.closeBlock(t)},parse:{}}}}});function Pt(e,t){const r=e.type.schema,n=J(D.from(e),r);return e.isBlock&&(t instanceof D||t.type.name===r.topNodeType.name)?qt(n):n}function qt(e){const r=H(e).firstElementChild;return r.innerHTML=r.innerHTML.trim()?`
${r.innerHTML}
`:`
`,r.outerHTML}const jt=g.create({name:"blockquote"}),Rt=jt.extend({addStorage(){return{markdown:{serialize:k.nodes.blockquote,parse:{}}}}}),Ft=g.create({name:"bulletList"}),Y=Ft.extend({addStorage(){return{markdown:{serialize(e,t){return e.renderList(t,"  ",()=>(this.editor.storage.markdown.options.bulletListMarker||"-")+" ")},parse:{}}}}}),Wt=g.create({name:"codeBlock"}),Gt=Wt.extend({addStorage(){return{markdown:{serialize(e,t){e.write("```"+(t.attrs.language||"")+`
`),e.text(t.textContent,!1),e.ensureNewLine(),e.write("```"),e.closeBlock(t)},parse:{setup(e){var t;e.set({langPrefix:(t=this.options.languageClassPrefix)!==null&&t!==void 0?t:"language-"})},updateDOM(e){e.innerHTML=e.innerHTML.replace(/\n<\/code><\/pre>/g,"</code></pre>")}}}}}}),Vt=g.create({name:"hardBreak"}),Z=Vt.extend({addStorage(){return{markdown:{serialize(e,t,r,n){for(let i=n+1;i<r.childCount;i++)if(r.child(i).type!=t.type){e.write(e.inTable?z.storage.markdown.serialize.call(this,e,t,r):`\\
`);return}},parse:{}}}}}),Jt=g.create({name:"heading"}),Ut=Jt.extend({addStorage(){return{markdown:{serialize:k.nodes.heading,parse:{}}}}}),Kt=g.create({name:"horizontalRule"}),Xt=Kt.extend({addStorage(){return{markdown:{serialize:k.nodes.horizontal_rule,parse:{}}}}}),Qt=g.create({name:"image"}),Yt=Qt.extend({addStorage(){return{markdown:{serialize:k.nodes.image,parse:{}}}}}),Zt=g.create({name:"listItem"}),te=Zt.extend({addStorage(){return{markdown:{serialize:k.nodes.list_item,parse:{}}}}}),ee=g.create({name:"orderedList"});function re(e,t,r){let n=0;for(;r-n>0&&t.child(r-n-1).type.name===e.type.name;n++);return n}const ne=ee.extend({addStorage(){return{markdown:{serialize(e,t,r,n){const i=t.attrs.start||1,o=String(i+t.childCount-1).length,s=e.repeat(" ",o+2),l=re(t,r,n)%2?") ":". ";e.renderList(t,s,a=>{const h=String(i+a);return e.repeat(" ",o-h.length)+h+l})},parse:{}}}}}),ie=g.create({name:"paragraph"}),se=ie.extend({addStorage(){return{markdown:{serialize:k.nodes.paragraph,parse:{}}}}});function B(e){var t,r;return(t=e==null||(r=e.content)===null||r===void 0?void 0:r.content)!==null&&t!==void 0?t:[]}const oe=g.create({name:"table"}),ae=oe.extend({addStorage(){return{markdown:{serialize(e,t,r){if(!le(t)){z.storage.markdown.serialize.call(this,e,t,r);return}e.inTable=!0,t.forEach((n,i,o)=>{if(e.write("| "),n.forEach((s,c,l)=>{l&&e.write(" | ");const a=s.firstChild;a.textContent.trim()&&e.renderInline(a)}),e.write(" |"),e.ensureNewLine(),!o){const s=Array.from({length:n.childCount}).map(()=>"---").join(" | ");e.write(`| ${s} |`),e.ensureNewLine()}}),e.closeBlock(t),e.inTable=!1},parse:{}}}}});function V(e){return e.attrs.colspan>1||e.attrs.rowspan>1}function le(e){const t=B(e),r=t[0],n=t.slice(1);return!(B(r).some(i=>i.type.name!=="tableHeader"||V(i)||i.childCount>1)||n.some(i=>B(i).some(o=>o.type.name==="tableHeader"||V(o)||o.childCount>1)))}const ce=g.create({name:"taskItem"}),de=ce.extend({addStorage(){return{markdown:{serialize(e,t){const r=t.attrs.checked?"[x]":"[ ]";e.write(`${r} `),e.renderContent(t)},parse:{updateDOM(e){[...e.querySelectorAll(".task-list-item")].forEach(t=>{const r=t.querySelector("input");t.setAttribute("data-type","taskItem"),r&&(t.setAttribute("data-checked",r.checked),r.remove())})}}}}}}),ue=g.create({name:"taskList"}),he=ue.extend({addStorage(){return{markdown:{serialize:Y.storage.markdown.serialize,parse:{setup(e){e.use(bt)},updateDOM(e){[...e.querySelectorAll(".contains-task-list")].forEach(t=>{t.setAttribute("data-type","taskList")})}}}}}}),pe=g.create({name:"text"}),me=pe.extend({addStorage(){return{markdown:{serialize(e,t){e.text(At(t.text))},parse:{}}}}}),ge=x.create({name:"bold"}),fe=ge.extend({addStorage(){return{markdown:{serialize:k.marks.strong,parse:{}}}}}),ke=x.create({name:"code"}),we=ke.extend({addStorage(){return{markdown:{serialize:k.marks.code,parse:{}}}}}),be=x.create({name:"italic"}),xe=be.extend({addStorage(){return{markdown:{serialize:k.marks.em,parse:{}}}}}),Me=x.create({name:"link"}),Te=Me.extend({addStorage(){return{markdown:{serialize:k.marks.link,parse:{}}}}}),ve=x.create({name:"strike"}),ye=ve.extend({addStorage(){return{markdown:{serialize:{open:"~~",close:"~~",expelEnclosingWhitespace:!0},parse:{}}}}}),Se=[Rt,Y,Gt,Z,Ut,Xt,z,Yt,te,ne,se,ae,de,he,me,fe,we,Q,xe,Te,ye];function _(e){var t,r;const n=(t=e.storage)===null||t===void 0?void 0:t.markdown,i=(r=Se.find(o=>o.name===e.name))===null||r===void 0?void 0:r.storage.markdown;return n||i?{...i,...n}:null}class Ce{constructor(t){C(this,"editor",null),this.editor=t}serialize(t){const r=new Nt(this.nodes,this.marks,{hardBreakNodeName:Z.name});return r.renderContent(t),r.out}get nodes(){var t;return{...Object.fromEntries(Object.keys(this.editor.schema.nodes).map(r=>[r,this.serializeNode(z)])),...Object.fromEntries((t=this.editor.extensionManager.extensions.filter(r=>r.type==="node"&&this.serializeNode(r)).map(r=>[r.name,this.serializeNode(r)]))!==null&&t!==void 0?t:[])}}get marks(){var t;return{...Object.fromEntries(Object.keys(this.editor.schema.marks).map(r=>[r,this.serializeMark(Q)])),...Object.fromEntries((t=this.editor.extensionManager.extensions.filter(r=>r.type==="mark"&&this.serializeMark(r)).map(r=>[r.name,this.serializeMark(r)]))!==null&&t!==void 0?t:[])}}serializeNode(t){var r;return(r=_(t))===null||r===void 0||(r=r.serialize)===null||r===void 0?void 0:r.bind({editor:this.editor,options:t.options})}serializeMark(t){var r;const n=(r=_(t))===null||r===void 0?void 0:r.serialize;return n?{...n,open:typeof n.open=="function"?n.open.bind({editor:this.editor,options:t.options}):n.open,close:typeof n.close=="function"?n.close.bind({editor:this.editor,options:t.options}):n.close}:null}}class _e{constructor(t,r){C(this,"editor",null),C(this,"md",null);let{html:n,linkify:i,breaks:o}=r;this.editor=t,this.md=this.withPatchedRenderer(A({html:n,linkify:i,breaks:o}))}parse(t){let{inline:r}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof t=="string"){this.editor.extensionManager.extensions.forEach(o=>{var s;return(s=_(o))===null||s===void 0||(s=s.parse)===null||s===void 0||(s=s.setup)===null||s===void 0?void 0:s.call({editor:this.editor,options:o.options},this.md)});const n=this.md.render(t),i=H(n);return this.editor.extensionManager.extensions.forEach(o=>{var s;return(s=_(o))===null||s===void 0||(s=s.parse)===null||s===void 0||(s=s.updateDOM)===null||s===void 0?void 0:s.call({editor:this.editor,options:o.options},i)}),this.normalizeDOM(i,{inline:r,content:t}),i.innerHTML}return t}normalizeDOM(t,r){let{inline:n,content:i}=r;return this.normalizeBlocks(t),t.querySelectorAll("*").forEach(o=>{var s;((s=o.nextSibling)===null||s===void 0?void 0:s.nodeType)===Node.TEXT_NODE&&!o.closest("pre")&&(o.nextSibling.textContent=o.nextSibling.textContent.replace(/^\n/,""))}),n&&this.normalizeInline(t,i),t}normalizeBlocks(t){const n=Object.values(this.editor.schema.nodes).filter(i=>i.isBlock).map(i=>{var o;return(o=i.spec.parseDOM)===null||o===void 0?void 0:o.map(s=>s.tag)}).flat().filter(Boolean).join(",");n&&[...t.querySelectorAll(n)].forEach(i=>{i.parentElement.matches("p")&&Ht(i)})}normalizeInline(t,r){var n;if((n=t.firstElementChild)!==null&&n!==void 0&&n.matches("p")){var i,o,s,c;const l=t.firstElementChild,{nextElementSibling:a}=l,h=(i=(o=r.match(/^\s+/))===null||o===void 0?void 0:o[0])!==null&&i!==void 0?i:"",w=a?"":(s=(c=r.match(/\s+$/))===null||c===void 0?void 0:c[0])!==null&&s!==void 0?s:"";if(r.match(/^\n\n/)){l.innerHTML=`${l.innerHTML}${w}`;return}It(l),t.innerHTML=`${h}${t.innerHTML}${w}`}}withPatchedRenderer(t){const r=n=>function(){const i=n(...arguments);return i===`
`?i:i[i.length-1]===`
`?i.slice(0,-1):i};return t.renderer.rules.hardbreak=r(t.renderer.rules.hardbreak),t.renderer.rules.softbreak=r(t.renderer.rules.softbreak),t.renderer.rules.fence=r(t.renderer.rules.fence),t.renderer.rules.code_block=r(t.renderer.rules.code_block),t.renderer.renderToken=r(t.renderer.renderToken.bind(t.renderer)),t}}const ze=N.create({name:"markdownClipboard",addOptions(){return{transformPastedText:!1,transformCopiedText:!1}},addProseMirrorPlugins(){return[new pt({key:new mt("markdownClipboard"),props:{clipboardTextParser:(e,t,r)=>{if(r||!this.options.transformPastedText)return null;const n=this.editor.storage.markdown.parser.parse(e,{inline:!0});return gt.fromSchema(this.editor.schema).parseSlice(H(n),{preserveWhitespace:!0,context:t})},clipboardTextSerializer:e=>this.options.transformCopiedText?this.editor.storage.markdown.serializer.serialize(e.content):null}})]}}),Le=N.create({name:"markdown",priority:50,addOptions(){return{html:!0,tightLists:!0,tightListClass:"tight",bulletListMarker:"-",linkify:!1,breaks:!1,transformPastedText:!1,transformCopiedText:!1}},addCommands(){const e=ft.Commands.config.addCommands();return{setContent:(t,r,n)=>i=>e.setContent(i.editor.storage.markdown.parser.parse(t),r,n)(i),insertContentAt:(t,r,n)=>i=>e.insertContentAt(t,i.editor.storage.markdown.parser.parse(r,{inline:!0}),n)(i)}},onBeforeCreate(){this.editor.storage.markdown={options:{...this.options},parser:new _e(this.editor,this.options),serializer:new Ce(this.editor),getMarkdown:()=>this.editor.storage.markdown.serializer.serialize(this.editor.state.doc)},this.editor.options.initialContent=this.editor.options.content,this.editor.options.content=this.editor.storage.markdown.parser.parse(this.editor.options.content)},onCreate(){this.editor.options.content=this.editor.options.initialContent,delete this.editor.options.initialContent},addStorage(){return{}},addExtensions(){return[$t.configure({tight:this.options.tightLists,tightClass:this.options.tightListClass}),ze.configure({transformPastedText:this.options.transformPastedText,transformCopiedText:this.options.transformCopiedText})]}}),tt=e=>(dt("data-v-70ab20c9"),e=e(),ut(),e),Oe={class:"container-fluid"},$e={key:0},Be=tt(()=>b("h1",null,"Content Editor",-1)),Ee={key:1},De=tt(()=>b("div",{class:"d-flex justify-content-between"},[b("h1",null,"Lesson Detail Content Editor")],-1)),Ne={__name:"EditorTiptapView",setup(e){const t=rt(),r=nt(),n=y(t.name),i=y(t.params.type),o=y(t.params.id);function s(){return i.value==="lesson"}function c(){return i.value==="textbook"}function l(){return n.value==="editor"}const a=y("#Loading"),h=kt({content:a.value,extensions:[wt,Le]});it(()=>a,p=>{h.commands.setContent(p)});const w=()=>{let p=h.value.storage.markdown.getMarkdown();console.log(p)},v=()=>{let p=h.value.getJSON();console.log(p)};return st(async()=>{console.log("This is TipTap");try{if(s())console.log("Fetching"),a.value=await xt(o);else if(c()){let p=await Mt(o);a.value=p.md}}catch(p){console.log(p)}h.value.commands.setContent(a.value)}),ot(async()=>{}),at(()=>{h.value.destroy()}),(p,f)=>(S(),L("div",Oe,[b("button",{onClick:f[0]||(f[0]=d=>M(r).go(-1)),class:"btn btn-primary"},"Return to Last Page"),b("button",{onClick:f[1]||(f[1]=d=>w()),class:"btn btn-primary"},"Get Markdown"),b("button",{onClick:f[2]||(f[2]=d=>v()),class:"btn btn-primary"},"Get JSON CONVERTED Markdown"),l()?(S(),L("div",$e,[Be,lt(M(q),{editor:M(h)},null,8,["editor"])])):P("",!0),s()||c()?(S(),L("div",Ee,[De,(S(),ct(M(q),{editor:M(h),key:a.value},null,8,["editor"]))])):P("",!0)]))}},We=et(Ne,[["__scopeId","data-v-70ab20c9"]]);export{We as default};
